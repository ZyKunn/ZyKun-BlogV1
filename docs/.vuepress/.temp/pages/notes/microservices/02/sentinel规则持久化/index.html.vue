<template><div><h1 id="sentinel-è§„åˆ™æŒä¹…åŒ–-ğŸ§™" tabindex="-1"><a class="header-anchor" href="#sentinel-è§„åˆ™æŒä¹…åŒ–-ğŸ§™" aria-hidden="true">#</a> Sentinel è§„åˆ™æŒä¹…åŒ– ğŸ§™</h1>
<nav class="table-of-contents"><ul><li><router-link to="#ä¸€ã€ä¿®æ”¹-order-service-æœåŠ¡">ä¸€ã€ä¿®æ”¹ order-service æœåŠ¡</router-link><ul><li><router-link to="#_1-å¼•å…¥ä¾èµ–">1.å¼•å…¥ä¾èµ–</router-link></li><li><router-link to="#_2-é…ç½®-nacos-åœ°å€">2.é…ç½® nacos åœ°å€</router-link></li></ul></li><li><router-link to="#äºŒã€ä¿®æ”¹-sentinel-dashboard-æºç ">äºŒã€ä¿®æ”¹ sentinel-dashboard æºç </router-link><ul><li><router-link to="#_1-è§£å‹">1. è§£å‹</router-link></li><li><router-link to="#_2-ä¿®æ”¹-nacos-ä¾èµ–">2. ä¿®æ”¹ nacos ä¾èµ–</router-link></li><li><router-link to="#_3-æ·»åŠ -nacos-æ”¯æŒ">3. æ·»åŠ  nacos æ”¯æŒ</router-link></li><li><router-link to="#_4-ä¿®æ”¹-nacos-åœ°å€">4. ä¿®æ”¹ nacos åœ°å€</router-link></li><li><router-link to="#_5-é…ç½®-nacos-æ•°æ®æº">5. é…ç½® nacos æ•°æ®æº</router-link></li><li><router-link to="#_6-ä¿®æ”¹å‰ç«¯é¡µé¢">6. ä¿®æ”¹å‰ç«¯é¡µé¢</router-link></li><li><router-link to="#_7-é‡æ–°ç¼–è¯‘ã€æ‰“åŒ…é¡¹ç›®">7. é‡æ–°ç¼–è¯‘ã€æ‰“åŒ…é¡¹ç›®</router-link></li><li><router-link to="#_8-å¯åŠ¨">8.å¯åŠ¨</router-link></li></ul></li></ul></nav>
<h2 id="ä¸€ã€ä¿®æ”¹-order-service-æœåŠ¡" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€ä¿®æ”¹-order-service-æœåŠ¡" aria-hidden="true">#</a> ä¸€ã€ä¿®æ”¹ order-service æœåŠ¡</h2>
<p>ä¿®æ”¹ OrderServiceï¼Œè®©å…¶ç›‘å¬ Nacos ä¸­çš„ sentinel è§„åˆ™é…ç½®ã€‚</p>
<p>å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<h3 id="_1-å¼•å…¥ä¾èµ–" tabindex="-1"><a class="header-anchor" href="#_1-å¼•å…¥ä¾èµ–" aria-hidden="true">#</a> 1.å¼•å…¥ä¾èµ–</h3>
<p>åœ¨ order-service ä¸­å¼•å…¥ sentinel ç›‘å¬ nacos çš„ä¾èµ–ï¼š</p>
<div class="language-xml line-numbers-mode" data-ext="xml"><pre v-pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba.csp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>sentinel-datasource-nacos<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-é…ç½®-nacos-åœ°å€" tabindex="-1"><a class="header-anchor" href="#_2-é…ç½®-nacos-åœ°å€" aria-hidden="true">#</a> 2.é…ç½® nacos åœ°å€</h3>
<p>åœ¨ order-service ä¸­çš„ application.yml æ–‡ä»¶é…ç½® nacos åœ°å€åŠç›‘å¬çš„é…ç½®ä¿¡æ¯ï¼š</p>
<div class="language-yaml line-numbers-mode" data-ext="yml"><pre v-pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">sentinel</span><span class="token punctuation">:</span>
      <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
        <span class="token key atrule">flow</span><span class="token punctuation">:</span>
          <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
            <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment"># nacosåœ°å€</span>
            <span class="token key atrule">dataId</span><span class="token punctuation">:</span> orderservice<span class="token punctuation">-</span>flow<span class="token punctuation">-</span>rules
            <span class="token key atrule">groupId</span><span class="token punctuation">:</span> SENTINEL_GROUP
            <span class="token key atrule">rule-type</span><span class="token punctuation">:</span> flow <span class="token comment"># è¿˜å¯ä»¥æ˜¯ï¼šdegradeã€authorityã€param-flow</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="äºŒã€ä¿®æ”¹-sentinel-dashboard-æºç " tabindex="-1"><a class="header-anchor" href="#äºŒã€ä¿®æ”¹-sentinel-dashboard-æºç " aria-hidden="true">#</a> äºŒã€ä¿®æ”¹ sentinel-dashboard æºç </h2>
<p>SentinelDashboard é»˜è®¤ä¸æ”¯æŒ nacos çš„æŒä¹…åŒ–ï¼Œéœ€è¦ä¿®æ”¹æºç ã€‚</p>
<h3 id="_1-è§£å‹" tabindex="-1"><a class="header-anchor" href="#_1-è§£å‹" aria-hidden="true">#</a> 1. è§£å‹</h3>
<p>è§£å‹è¯¾å‰èµ„æ–™ä¸­çš„ sentinel æºç åŒ…ï¼š</p>
<p><img src="@source/notes/microservices/02/sentinelè§„åˆ™æŒä¹…åŒ–/assets/image-20210618201340086.png" alt="image-20210618201340086"></p>
<p>ç„¶åå¹¶ç”¨ IDEA æ‰“å¼€è¿™ä¸ªé¡¹ç›®ï¼Œç»“æ„å¦‚ä¸‹ï¼š</p>
<p><img src="@source/notes/microservices/02/sentinelè§„åˆ™æŒä¹…åŒ–/assets/image-20210618201412878.png" alt="image-20210618201412878"></p>
<h3 id="_2-ä¿®æ”¹-nacos-ä¾èµ–" tabindex="-1"><a class="header-anchor" href="#_2-ä¿®æ”¹-nacos-ä¾èµ–" aria-hidden="true">#</a> 2. ä¿®æ”¹ nacos ä¾èµ–</h3>
<p>åœ¨ sentinel-dashboard æºç çš„ pom æ–‡ä»¶ä¸­ï¼Œnacos çš„ä¾èµ–é»˜è®¤çš„ scope æ˜¯ testï¼Œåªèƒ½åœ¨æµ‹è¯•æ—¶ä½¿ç”¨ï¼Œè¿™é‡Œè¦å»é™¤ï¼š</p>
<p><img src="@source/notes/microservices/02/sentinelè§„åˆ™æŒä¹…åŒ–/assets/image-20210618201607831.png" alt="image-20210618201607831"></p>
<p>å°† sentinel-datasource-nacos ä¾èµ–çš„ scope å»æ‰ï¼š</p>
<div class="language-xml line-numbers-mode" data-ext="xml"><pre v-pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba.csp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>sentinel-datasource-nacos<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-æ·»åŠ -nacos-æ”¯æŒ" tabindex="-1"><a class="header-anchor" href="#_3-æ·»åŠ -nacos-æ”¯æŒ" aria-hidden="true">#</a> 3. æ·»åŠ  nacos æ”¯æŒ</h3>
<p>åœ¨ sentinel-dashboard çš„ test åŒ…ä¸‹ï¼Œå·²ç»ç¼–å†™äº†å¯¹ nacos çš„æ”¯æŒï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶æ‹·è´åˆ° main ä¸‹ã€‚</p>
<p><img src="@source/notes/microservices/02/sentinelè§„åˆ™æŒä¹…åŒ–/assets/image-20210618201726280.png" alt="image-20210618201726280"></p>
<h3 id="_4-ä¿®æ”¹-nacos-åœ°å€" tabindex="-1"><a class="header-anchor" href="#_4-ä¿®æ”¹-nacos-åœ°å€" aria-hidden="true">#</a> 4. ä¿®æ”¹ nacos åœ°å€</h3>
<p>ç„¶åï¼Œè¿˜éœ€è¦ä¿®æ”¹æµ‹è¯•ä»£ç ä¸­çš„ NacosConfig ç±»ï¼š</p>
<p><img src="@source/notes/microservices/02/sentinelè§„åˆ™æŒä¹…åŒ–/assets/image-20210618201912078.png" alt="image-20210618201912078"></p>
<p>ä¿®æ”¹å…¶ä¸­çš„ nacos åœ°å€ï¼Œè®©å…¶è¯»å– application.properties ä¸­çš„é…ç½®ï¼š</p>
<p><img src="@source/notes/microservices/02/sentinelè§„åˆ™æŒä¹…åŒ–/assets/image-20210618202047575.png" alt="image-20210618202047575"></p>
<p>åœ¨ sentinel-dashboard çš„ application.properties ä¸­æ·»åŠ  nacos åœ°å€é…ç½®ï¼š</p>
<div class="language-properties line-numbers-mode" data-ext="properties"><pre v-pre class="language-properties"><code><span class="token key attr-name">nacos.addr</span><span class="token punctuation">=</span><span class="token value attr-value">localhost:8848</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_5-é…ç½®-nacos-æ•°æ®æº" tabindex="-1"><a class="header-anchor" href="#_5-é…ç½®-nacos-æ•°æ®æº" aria-hidden="true">#</a> 5. é…ç½® nacos æ•°æ®æº</h3>
<p>å¦å¤–ï¼Œè¿˜éœ€è¦ä¿®æ”¹ com.alibaba.csp.sentinel.dashboard.controller.v2 åŒ…ä¸‹çš„ FlowControllerV2 ç±»ï¼š</p>
<p><img src="@source/notes/microservices/02/sentinelè§„åˆ™æŒä¹…åŒ–/assets/image-20210618202322301.png" alt="image-20210618202322301"></p>
<p>è®©æˆ‘ä»¬æ·»åŠ çš„ Nacos æ•°æ®æºç”Ÿæ•ˆï¼š</p>
<p><img src="@source/notes/microservices/02/sentinelè§„åˆ™æŒä¹…åŒ–/assets/image-20210618202334536.png" alt="image-20210618202334536"></p>
<h3 id="_6-ä¿®æ”¹å‰ç«¯é¡µé¢" tabindex="-1"><a class="header-anchor" href="#_6-ä¿®æ”¹å‰ç«¯é¡µé¢" aria-hidden="true">#</a> 6. ä¿®æ”¹å‰ç«¯é¡µé¢</h3>
<p>æ¥ä¸‹æ¥ï¼Œè¿˜è¦ä¿®æ”¹å‰ç«¯é¡µé¢ï¼Œæ·»åŠ ä¸€ä¸ªæ”¯æŒ nacos çš„èœå•ã€‚</p>
<p>ä¿®æ”¹ src/main/webapp/resources/app/scripts/directives/sidebar/ç›®å½•ä¸‹çš„ sidebar.html æ–‡ä»¶ï¼š</p>
<p><img src="@source/notes/microservices/02/sentinelè§„åˆ™æŒä¹…åŒ–/assets/image-20210618202433356.png" alt="image-20210618202433356"></p>
<p>å°†å…¶ä¸­çš„è¿™éƒ¨åˆ†æ³¨é‡Šæ‰“å¼€ï¼š</p>
<p><img src="@source/notes/microservices/02/sentinelè§„åˆ™æŒä¹…åŒ–/assets/image-20210618202449881.png" alt="image-20210618202449881"></p>
<p>ä¿®æ”¹å…¶ä¸­çš„æ–‡æœ¬ï¼š</p>
<p><img src="@source/notes/microservices/02/sentinelè§„åˆ™æŒä¹…åŒ–/assets/image-20210618202501928.png" alt="image-20210618202501928"></p>
<h3 id="_7-é‡æ–°ç¼–è¯‘ã€æ‰“åŒ…é¡¹ç›®" tabindex="-1"><a class="header-anchor" href="#_7-é‡æ–°ç¼–è¯‘ã€æ‰“åŒ…é¡¹ç›®" aria-hidden="true">#</a> 7. é‡æ–°ç¼–è¯‘ã€æ‰“åŒ…é¡¹ç›®</h3>
<p>è¿è¡Œ IDEA ä¸­çš„ maven æ’ä»¶ï¼Œç¼–è¯‘å’Œæ‰“åŒ…ä¿®æ”¹å¥½çš„ Sentinel-Dashboardï¼š</p>
<p><img src="@source/notes/microservices/02/sentinelè§„åˆ™æŒä¹…åŒ–/assets/image-20210618202701492.png" alt="image-20210618202701492"></p>
<h3 id="_8-å¯åŠ¨" tabindex="-1"><a class="header-anchor" href="#_8-å¯åŠ¨" aria-hidden="true">#</a> 8.å¯åŠ¨</h3>
<p>å¯åŠ¨æ–¹å¼è·Ÿå®˜æ–¹ä¸€æ ·ï¼š</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token function">java</span> <span class="token parameter variable">-jar</span> sentinel-dashboard.jar
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å¦‚æœè¦ä¿®æ”¹ nacos åœ°å€ï¼Œéœ€è¦æ·»åŠ å‚æ•°ï¼š</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token function">java</span> <span class="token parameter variable">-jar</span> <span class="token parameter variable">-Dnacos.addr</span><span class="token operator">=</span>localhost:8848 sentinel-dashboard.jar
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div></template>


