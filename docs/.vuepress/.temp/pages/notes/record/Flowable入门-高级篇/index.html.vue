<template><div><h1 id="ğŸflowable-å…¥é—¨-é«˜çº§ç¯‡" tabindex="-1"><a class="header-anchor" href="#ğŸflowable-å…¥é—¨-é«˜çº§ç¯‡" aria-hidden="true">#</a> ğŸFlowable å…¥é—¨-é«˜çº§ç¯‡</h1>
<hr/>
<nav class="table-of-contents"><ul><li><router-link to="#_1-ä»»åŠ¡åˆ†é…">1.ä»»åŠ¡åˆ†é…</router-link><ul><li><router-link to="#_1-1-å›ºå®šåˆ†é…">1.1 å›ºå®šåˆ†é…</router-link></li><li><router-link to="#_1-2-è¡¨è¾¾å¼åˆ†é…">1.2 è¡¨è¾¾å¼åˆ†é…</router-link></li><li><router-link to="#_1-3-ç›‘å¬å™¨åˆ†é…">1.3 ç›‘å¬å™¨åˆ†é…</router-link></li></ul></li><li><router-link to="#_2-æµç¨‹å˜é‡">2.æµç¨‹å˜é‡</router-link><ul><li><router-link to="#_2-1-å…¨å±€å˜é‡">2.1 å…¨å±€å˜é‡</router-link></li><li><router-link to="#_2-2-å±€éƒ¨å˜é‡">2.2 å±€éƒ¨å˜é‡</router-link></li><li><router-link to="#_2-3-æ¡ˆä¾‹è®²è§£">2.3 æ¡ˆä¾‹è®²è§£</router-link></li></ul></li><li><router-link to="#_1-å€™é€‰äºº">1.å€™é€‰äºº</router-link><ul><li><router-link to="#_1-1-å®šä¹‰æµç¨‹å›¾">1.1 å®šä¹‰æµç¨‹å›¾</router-link></li><li><router-link to="#_1-2-éƒ¨ç½²å’Œå¯åŠ¨æµç¨‹å®ä¾‹">1.2 éƒ¨ç½²å’Œå¯åŠ¨æµç¨‹å®ä¾‹</router-link></li><li><router-link to="#_1-3-ä»»åŠ¡çš„æŸ¥è¯¢">1.3 ä»»åŠ¡çš„æŸ¥è¯¢</router-link></li><li><router-link to="#_1-4-ä»»åŠ¡çš„æ‹¾å–">1.4 ä»»åŠ¡çš„æ‹¾å–</router-link></li><li><router-link to="#_1-5-ä»»åŠ¡çš„å½’è¿˜">1.5 ä»»åŠ¡çš„å½’è¿˜</router-link></li><li><router-link to="#_1-6-ä»»åŠ¡çš„äº¤æ¥-å§”æ´¾">1.6 ä»»åŠ¡çš„äº¤æ¥ï¼ˆå§”æ´¾ï¼‰</router-link></li><li><router-link to="#_1-7-ä»»åŠ¡çš„å®Œæˆ">1.7 ä»»åŠ¡çš„å®Œæˆ</router-link></li></ul></li><li><router-link to="#_2-å€™é€‰äººç»„">2.å€™é€‰äººç»„</router-link><ul><li><router-link to="#_2-1-ç®¡ç†ç”¨æˆ·å’Œç»„">2.1 ç®¡ç†ç”¨æˆ·å’Œç»„</router-link></li><li><router-link to="#_2-2-å€™é€‰äººç»„åº”ç”¨">2.2 å€™é€‰äººç»„åº”ç”¨</router-link></li></ul></li><li><router-link to="#_1-æ’ä»–ç½‘å…³">1.æ’ä»–ç½‘å…³</router-link></li><li><router-link to="#_2-å¹¶è¡Œç½‘å…³">2.å¹¶è¡Œç½‘å…³</router-link></li><li><router-link to="#_3-åŒ…å«ç½‘å…³">3.åŒ…å«ç½‘å…³</router-link></li><li><router-link to="#_4-äº‹ä»¶ç½‘å…³">4.äº‹ä»¶ç½‘å…³</router-link></li></ul></nav>
<h1 id="ä¸€ã€ä»»åŠ¡åˆ†é…å’Œæµç¨‹å˜é‡" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€ä»»åŠ¡åˆ†é…å’Œæµç¨‹å˜é‡" aria-hidden="true">#</a> ä¸€ã€ä»»åŠ¡åˆ†é…å’Œæµç¨‹å˜é‡</h1>
<h2 id="_1-ä»»åŠ¡åˆ†é…" tabindex="-1"><a class="header-anchor" href="#_1-ä»»åŠ¡åˆ†é…" aria-hidden="true">#</a> 1.ä»»åŠ¡åˆ†é…</h2>
<h3 id="_1-1-å›ºå®šåˆ†é…" tabindex="-1"><a class="header-anchor" href="#_1-1-å›ºå®šåˆ†é…" aria-hidden="true">#</a> 1.1 å›ºå®šåˆ†é…</h3>
<p>â€ƒâ€ƒå›ºå®šåˆ†é…å°±æ˜¯æˆ‘ä»¬å‰é¢ä»‹ç»çš„ï¼Œåœ¨ç»˜åˆ¶æµç¨‹å›¾æˆ–è€…ç›´æ¥åœ¨æµç¨‹æ–‡ä»¶ä¸­é€šè¿‡ Assignee æ¥æŒ‡å®šçš„æ–¹å¼</p>
<p><img src="@source/notes/record/Flowableå…¥é—¨-é«˜çº§ç¯‡/assets/image-20220322205919319.png" alt="image-20220322205919319"></p>
<p><img src="@source/notes/record/Flowableå…¥é—¨-é«˜çº§ç¯‡/assets/image-20220322210018615.png" alt="image-20220322210018615"></p>
<h3 id="_1-2-è¡¨è¾¾å¼åˆ†é…" tabindex="-1"><a class="header-anchor" href="#_1-2-è¡¨è¾¾å¼åˆ†é…" aria-hidden="true">#</a> 1.2 è¡¨è¾¾å¼åˆ†é…</h3>
<p>â€ƒâ€ƒFlowable ä½¿ç”¨ UEL è¿›è¡Œè¡¨è¾¾å¼è§£æã€‚UEL ä»£è¡¨<em>Unified Expression Language</em>ï¼Œæ˜¯ EE6 è§„èŒƒçš„ä¸€éƒ¨åˆ†.Flowable æ”¯æŒä¸¤ç§ UEL è¡¨è¾¾å¼ï¼š UEL-value å’Œ UEL-method</p>
<h4 id="_1-2-1-å€¼è¡¨è¾¾å¼" tabindex="-1"><a class="header-anchor" href="#_1-2-1-å€¼è¡¨è¾¾å¼" aria-hidden="true">#</a> 1.2.1 å€¼è¡¨è¾¾å¼</h4>
<p>â€ƒâ€ƒ<strong>å€¼è¡¨è¾¾å¼ Value expression</strong>: è§£æä¸ºä¸€ä¸ªå€¼ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰æµç¨‹å˜é‡éƒ½å¯ä»¥ä½¿ç”¨ã€‚ï¼ˆè‹¥ä½¿ç”¨ Springï¼‰æ‰€æœ‰çš„ Spring bean ä¹Ÿå¯ä»¥ç”¨åœ¨è¡¨è¾¾å¼é‡Œã€‚ä¾‹å¦‚</p>
<div class="language-txt line-numbers-mode" data-ext="txt"><pre v-pre class="language-txt"><code>${myVar}
${myBean.myProperty}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¡ˆä¾‹è®²è§£ï¼š</p>
<p><img src="@source/notes/record/Flowableå…¥é—¨-é«˜çº§ç¯‡/assets/image-20220322212342245.png" alt="image-20220322212342245"></p>
<p>å¯ä»¥çœ‹åˆ°é€šè¿‡è¡¨è¾¾å¼å¤„ç†çš„æ•ˆæœ</p>
<p><img src="@source/notes/record/Flowableå…¥é—¨-é«˜çº§ç¯‡/assets/image-20220322212431304.png" alt="image-20220322212431304"></p>
<p>å…ˆéƒ¨ç½²æµç¨‹ï¼Œç„¶ååœ¨å¯åŠ¨æµç¨‹å®ä¾‹çš„æ—¶å€™ç»‘å®šè¡¨è¾¾å¼å¯¹åº”çš„å€¼</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token doc-comment comment">/**
     * å¯åŠ¨æµç¨‹å®ä¾‹
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testRunProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token comment">// è·å–æµç¨‹å¼•æ“å¯¹è±¡</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å¯åŠ¨æµç¨‹å®ä¾‹é€šè¿‡ RuntimeService å¯¹è±¡</span>
        <span class="token class-name">RuntimeService</span> runtimeService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRuntimeService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è®¾ç½® assignee çš„å–å€¼</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> variables <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"assignee0"</span><span class="token punctuation">,</span><span class="token string">"å¼ ä¸‰"</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
        variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"assignee1"</span><span class="token punctuation">,</span><span class="token string">"æå››"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å¯åŠ¨æµç¨‹å®ä¾‹ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æµç¨‹å®šä¹‰çš„id</span>
        <span class="token class-name">ProcessInstance</span> processInstance <span class="token operator">=</span> runtimeService
                <span class="token punctuation">.</span><span class="token function">startProcessInstanceById</span><span class="token punctuation">(</span><span class="token string">"MyHolidayUI:1:4"</span><span class="token punctuation">,</span> variables<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å¯åŠ¨æµç¨‹å®ä¾‹</span>
        <span class="token comment">// è¾“å‡ºç›¸å…³çš„æµç¨‹å®ä¾‹ä¿¡æ¯</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æµç¨‹å®šä¹‰çš„IDï¼š"</span> <span class="token operator">+</span> processInstance<span class="token punctuation">.</span><span class="token function">getProcessDefinitionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æµç¨‹å®ä¾‹çš„IDï¼š"</span> <span class="token operator">+</span> processInstance<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ´»åŠ¨çš„IDï¼š"</span> <span class="token operator">+</span> processInstance<span class="token punctuation">.</span><span class="token function">getActivityId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æµç¨‹å˜é‡è¡¨ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¯¹åº”çš„æµç¨‹å˜é‡ä¿¡æ¯</p>
<p><img src="@source/notes/record/Flowableå…¥é—¨-é«˜çº§ç¯‡/assets/image-20220322213558754.png" alt="image-20220322213558754"></p>
<p>åŒæ—¶åœ¨ Task è¡¨ä¸­ï¼Œå¯ä»¥çœ‹åˆ°æµç¨‹å½“å‰çš„åˆ†é…äººæ˜¯<code v-pre>å¼ ä¸‰</code>ï¼Œè¯´æ˜ UEL è¡¨è¾¾å¼è¢«è§£æäº†</p>
<p><img src="@source/notes/record/Flowableå…¥é—¨-é«˜çº§ç¯‡/assets/image-20220322213655020.png" alt="image-20220322213655020"></p>
<h4 id="_1-2-2-æ–¹æ³•è¡¨è¾¾å¼" tabindex="-1"><a class="header-anchor" href="#_1-2-2-æ–¹æ³•è¡¨è¾¾å¼" aria-hidden="true">#</a> 1.2.2 æ–¹æ³•è¡¨è¾¾å¼</h4>
<p>â€ƒâ€ƒ<strong>æ–¹æ³•è¡¨è¾¾å¼ Method expression</strong>: è°ƒç”¨ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥å¸¦æˆ–ä¸å¸¦å‚æ•°ã€‚**å½“è°ƒç”¨ä¸å¸¦å‚æ•°çš„æ–¹æ³•æ—¶ï¼Œè¦ç¡®ä¿åœ¨æ–¹æ³•ååæ·»åŠ ç©ºæ‹¬å·ï¼ˆä»¥é¿å…ä¸å€¼è¡¨è¾¾å¼æ··æ·†ï¼‰ã€‚**ä¼ é€’çš„å‚æ•°å¯ä»¥æ˜¯å­—é¢å€¼(literal value)ï¼Œä¹Ÿå¯ä»¥æ˜¯è¡¨è¾¾å¼ï¼Œå®ƒä»¬ä¼šè¢«è‡ªåŠ¨è§£æã€‚ä¾‹å¦‚ï¼š</p>
<div class="language-txt line-numbers-mode" data-ext="txt"><pre v-pre class="language-txt"><code>${printer.print()}
${myBean.addNewOrder('orderName')}
${myBean.doSomething(myVar, execution)}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â€ƒâ€ƒmyBean æ˜¯ Spring å®¹å™¨ä¸­çš„ä¸ª Bean å¯¹è±¡ï¼Œè¡¨ç¤ºè°ƒç”¨çš„æ˜¯ bean çš„ addNewOrder æ–¹æ³•</p>
<h3 id="_1-3-ç›‘å¬å™¨åˆ†é…" tabindex="-1"><a class="header-anchor" href="#_1-3-ç›‘å¬å™¨åˆ†é…" aria-hidden="true">#</a> 1.3 ç›‘å¬å™¨åˆ†é…</h3>
<p>å¯ä»¥ä½¿ç”¨ç›‘å¬å™¨æ¥å®Œæˆå¾ˆå¤š Flowable çš„æµç¨‹ä¸šåŠ¡ã€‚</p>
<p>æˆ‘ä»¬åœ¨æ­¤å¤„ä½¿ç”¨ç›‘å¬å™¨æ¥å®Œæˆè´Ÿè´£äººçš„æŒ‡å®šï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨æµç¨‹è®¾è®¡çš„æ—¶å€™å°±ä¸éœ€è¦æŒ‡å®š assignee</p>
<p>åˆ›å»ºè‡ªå®šä¹‰ç›‘å¬å™¨ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token doc-comment comment">/**
 * è‡ªå®šä¹‰çš„ç›‘å¬å™¨
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyTaskListener</span> <span class="token keyword">implements</span> <span class="token class-name">TaskListener</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">notify</span><span class="token punctuation">(</span><span class="token class-name">DelegateTask</span> delegateTask<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç›‘å¬å™¨è§¦å‘äº†ï¼š"</span> <span class="token operator">+</span> delegateTask<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"æäº¤è¯·å‡æµç¨‹"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>delegateTask<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
                <span class="token string">"create"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>delegateTask<span class="token punctuation">.</span><span class="token function">getEventName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// æŒ‡å®šä»»åŠ¡çš„è´Ÿè´£äºº</span>
            delegateTask<span class="token punctuation">.</span><span class="token function">setAssignee</span><span class="token punctuation">(</span><span class="token string">"å°æ˜"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
            delegateTask<span class="token punctuation">.</span><span class="token function">setAssignee</span><span class="token punctuation">(</span><span class="token string">"å°å¼ "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶ååœ¨ FlowableUI ä¸­å…³è”å¯¹åº”çš„ç›‘å¬å™¨</p>
<div class="language-txt line-numbers-mode" data-ext="txt"><pre v-pre class="language-txt"><code>create:ä»»åŠ¡åˆ›å»ºåè§¦å‘
assignment:ä»»åŠ¡åˆ†é…åè§¦å‘
Delete:ä»»åŠ¡å®Œæˆåè§¦å‘
Allï¼šæ‰€æœ‰äº‹ä»¶éƒ½è§¦å‘
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="@source/notes/record/Flowableå…¥é—¨-é«˜çº§ç¯‡/assets/image-20220322214807416.png" alt="image-20220322214807416"></p>
<p>ç„¶åæˆ‘ä»¬å…ˆéƒ¨ç½²æµç¨‹ï¼Œç„¶åæ‰§è¡ŒæŸ¥çœ‹æ•ˆæœï¼š</p>
<p><img src="@source/notes/record/Flowableå…¥é—¨-é«˜çº§ç¯‡/assets/image-20220322215711211.png" alt="image-20220322215711211"></p>
<p>ç„¶ååœ¨ Task è¡¨ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¯¹åº”çš„åˆ†é…äººä¸º<code v-pre>å°æ˜</code>è¯´æ˜é€šè¿‡ç›‘å¬ä¹Ÿå®Œæˆäº†ä»»åŠ¡åˆ†é…çš„å·¥ä½œäº†</p>
<p><img src="@source/notes/record/Flowableå…¥é—¨-é«˜çº§ç¯‡/assets/image-20220322215805734.png" alt="image-20220322215805734"></p>
<h2 id="_2-æµç¨‹å˜é‡" tabindex="-1"><a class="header-anchor" href="#_2-æµç¨‹å˜é‡" aria-hidden="true">#</a> 2.æµç¨‹å˜é‡</h2>
<p>â€ƒâ€ƒæµç¨‹å®ä¾‹æŒ‰æ­¥éª¤æ‰§è¡Œæ—¶ï¼Œéœ€è¦ä½¿ç”¨ä¸€äº›æ•°æ®ã€‚åœ¨ Flowable ä¸­ï¼Œè¿™äº›æ•°æ®ç§°ä½œ<em>å˜é‡(variable)</em>ï¼Œå¹¶ä¼šå­˜å‚¨åœ¨æ•°æ®åº“ä¸­ã€‚å˜é‡å¯ä»¥ç”¨åœ¨è¡¨è¾¾å¼ä¸­ï¼ˆä¾‹å¦‚åœ¨æ’ä»–ç½‘å…³ä¸­ç”¨äºé€‰æ‹©æ­£ç¡®çš„å‡ºå£è·¯å¾„ï¼‰ï¼Œä¹Ÿå¯ä»¥åœ¨ Java æœåŠ¡ä»»åŠ¡(service task)ä¸­ç”¨äºè°ƒç”¨å¤–éƒ¨æœåŠ¡ï¼ˆä¾‹å¦‚ä¸ºæœåŠ¡è°ƒç”¨æä¾›è¾“å…¥æˆ–ç»“æœå­˜å‚¨ï¼‰ï¼Œç­‰ç­‰ã€‚</p>
<p>â€ƒâ€ƒæµç¨‹å®ä¾‹å¯ä»¥æŒæœ‰å˜é‡ï¼ˆç§°ä½œ<em>æµç¨‹å˜é‡ process variables</em>ï¼‰ï¼›ç”¨æˆ·ä»»åŠ¡ä»¥åŠ<em>æ‰§è¡Œ(executions)</em>â€”â€”æµç¨‹å½“å‰æ´»åŠ¨èŠ‚ç‚¹çš„æŒ‡é’ˆâ€”â€”ä¹Ÿå¯ä»¥æŒæœ‰å˜é‡ã€‚æµç¨‹å®ä¾‹å¯ä»¥æŒæœ‰ä»»æ„æ•°é‡çš„å˜é‡ï¼Œæ¯ä¸ªå˜é‡å­˜å‚¨ä¸º<em>ACT_RU_VARIABLE</em>æ•°æ®åº“è¡¨çš„ä¸€è¡Œã€‚</p>
<p>â€ƒâ€ƒæ‰€æœ‰çš„<em>startProcessInstanceXXX</em>æ–¹æ³•éƒ½æœ‰ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œç”¨äºåœ¨æµç¨‹å®ä¾‹åˆ›å»ºåŠå¯åŠ¨æ—¶è®¾ç½®å˜é‡ã€‚ä¾‹å¦‚ï¼Œåœ¨<em>RuntimeService</em>ä¸­ï¼š</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token class-name">ProcessInstance</span> <span class="token function">startProcessInstanceByKey</span><span class="token punctuation">(</span><span class="token class-name">String</span> processDefinitionKey<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> variables<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>â€ƒâ€ƒä¹Ÿå¯ä»¥åœ¨æµç¨‹æ‰§è¡Œä¸­åŠ å…¥å˜é‡ã€‚ä¾‹å¦‚ï¼Œ(<em>RuntimeService</em>):</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token keyword">void</span> <span class="token function">setVariable</span><span class="token punctuation">(</span><span class="token class-name">String</span> executionId<span class="token punctuation">,</span> <span class="token class-name">String</span> variableName<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">setVariableLocal</span><span class="token punctuation">(</span><span class="token class-name">String</span> executionId<span class="token punctuation">,</span> <span class="token class-name">String</span> variableName<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">setVariables</span><span class="token punctuation">(</span><span class="token class-name">String</span> executionId<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> variables<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">setVariablesLocal</span><span class="token punctuation">(</span><span class="token class-name">String</span> executionId<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> variables<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="@source/notes/record/Flowableå…¥é—¨-é«˜çº§ç¯‡/assets/image-20220324095243595.png" alt="image-20220324095243595"></p>
<h3 id="_2-1-å…¨å±€å˜é‡" tabindex="-1"><a class="header-anchor" href="#_2-1-å…¨å±€å˜é‡" aria-hidden="true">#</a> 2.1 å…¨å±€å˜é‡</h3>
<p>â€ƒâ€ƒæµç¨‹å˜é‡çš„é»˜è®¤ä½œç”¨åŸŸæ˜¯æµç¨‹å®ä¾‹ã€‚å½“ä¸€ä¸ªæµç¨‹å˜é‡çš„ä½œç”¨åŸŸä¸ºæµç¨‹å®ä¾‹æ—¶ï¼Œå¯ä»¥ç§°ä¸º global å˜é‡</p>
<p>æ³¨æ„ï¼šå¦‚ï¼š Global å˜é‡ï¼šuserIdï¼ˆå˜é‡åï¼‰ã€zhangsanï¼ˆå˜é‡å€¼ï¼‰</p>
<p>â€ƒâ€ƒglobal å˜é‡ä¸­å˜é‡åä¸å…è®¸é‡å¤ï¼Œè®¾ç½®ç›¸åŒåç§°çš„å˜é‡ï¼Œåè®¾ç½®çš„å€¼ä¼šè¦†ç›–å‰è®¾ç½®çš„å˜é‡å€¼ã€‚</p>
<h3 id="_2-2-å±€éƒ¨å˜é‡" tabindex="-1"><a class="header-anchor" href="#_2-2-å±€éƒ¨å˜é‡" aria-hidden="true">#</a> 2.2 å±€éƒ¨å˜é‡</h3>
<p>â€ƒâ€ƒä»»åŠ¡å’Œæ‰§è¡Œå®ä¾‹ä»…ä»…æ˜¯é’ˆå¯¹ä¸€ä¸ªä»»åŠ¡å’Œä¸€ä¸ªæ‰§è¡Œå®ä¾‹èŒƒå›´ï¼ŒèŒƒå›´æ²¡æœ‰æµç¨‹å®ä¾‹å¤§ï¼Œ ç§°ä¸º local å˜é‡ã€‚</p>
<p>â€ƒâ€ƒLocal å˜é‡ç”±äºåœ¨ä¸åŒçš„ä»»åŠ¡æˆ–ä¸åŒçš„æ‰§è¡Œå®ä¾‹ä¸­ï¼Œä½œç”¨åŸŸäº’ä¸å½±å“ï¼Œå˜é‡åå¯ä»¥ç›¸åŒæ²¡æœ‰å½±å“ã€‚Local å˜é‡åä¹Ÿå¯ä»¥å’Œ global å˜é‡åç›¸åŒï¼Œæ²¡æœ‰å½±å“ã€‚</p>
<h3 id="_2-3-æ¡ˆä¾‹è®²è§£" tabindex="-1"><a class="header-anchor" href="#_2-3-æ¡ˆä¾‹è®²è§£" aria-hidden="true">#</a> 2.3 æ¡ˆä¾‹è®²è§£</h3>
<p>éœ€æ±‚ï¼šå‘˜å·¥åˆ›å»ºå‡ºå·®ç”³è¯·å•ï¼Œç”±éƒ¨é—¨ç»ç†å®¡æ ¸ï¼Œéƒ¨é—¨ç»ç†ç”³è¯·é€šè¿‡å 3 å¤©ä»¥ä¸‹ç”±è´¢åŠ¡ç›´æ¥ç”³æ‰¹ï¼Œ3 å¤©ä»¥ä¸Šå…ˆç”±æ€»ç»ç†å®¡æ‰¹ï¼Œæ€»ç»ç†å®¡æ‰¹é€šè¿‡åå†ç”±è´¢åŠ¡å®¡æ‰¹ã€‚</p>
<p><img src="@source/notes/record/Flowableå…¥é—¨-é«˜çº§ç¯‡/assets/image-20220324093855618.png" alt="image-20220324093855618"></p>
<p>è¿æ¥å…ˆè®¾ç½®æ¡ä»¶</p>
<p><img src="@source/notes/record/Flowableå…¥é—¨-é«˜çº§ç¯‡/assets/image-20220324093806442.png" alt="image-20220324093806442"></p>
<p><img src="@source/notes/record/Flowableå…¥é—¨-é«˜çº§ç¯‡/assets/image-20220324093700631.png" alt="image-20220324093700631"></p>
<p><img src="@source/notes/record/Flowableå…¥é—¨-é«˜çº§ç¯‡/assets/image-20230706112706023.png" alt="image-20230706112706023"></p>
<p>éƒ¨ç½²æµç¨‹</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deploy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">RepositoryService</span> repositoryService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRepositoryService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Deployment</span> deploy <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">createDeployment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addClasspathResource</span><span class="token punctuation">(</span><span class="token string">"å‡ºå·®ç”³è¯·å•.bpmn20.xml"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">"è¯·å‡æµç¨‹..."</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">category</span><span class="token punctuation">(</span><span class="token string">"è¯·å‡"</span><span class="token punctuation">)</span> <span class="token comment">// åˆ†ç±»</span>
        <span class="token punctuation">.</span><span class="token function">tenantId</span><span class="token punctuation">(</span><span class="token string">"dpb"</span><span class="token punctuation">)</span> <span class="token comment">// ç§Ÿæˆ·id</span>
        <span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"deploy.getId() = "</span> <span class="token operator">+</span> deploy<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"deploy.getName() = "</span> <span class="token operator">+</span> deploy<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"deploy.getCategory() = "</span> <span class="token operator">+</span> deploy<span class="token punctuation">.</span><span class="token function">getCategory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯åŠ¨æµç¨‹å®ä¾‹ï¼šå¹¶ä¸”æŒ‡å®šå…¨å±€æµç¨‹å˜é‡</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token doc-comment comment">/**
     * åœ¨å¯åŠ¨æµç¨‹å®ä¾‹çš„æ—¶å€™è®¾ç½®æµç¨‹å˜é‡
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">runProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// è·å–æµç¨‹å¼•æ“å¯¹è±¡</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å¯åŠ¨æµç¨‹å®ä¾‹é€šè¿‡ RuntimeService å¯¹è±¡</span>
        <span class="token class-name">RuntimeService</span> runtimeService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRuntimeService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è®¾ç½®æµç¨‹å˜é‡</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> variables <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è®¾ç½®assigneeçš„å–å€¼</span>
        variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"assignee0"</span><span class="token punctuation">,</span><span class="token string">"å¼ ä¸‰"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"assignee1"</span><span class="token punctuation">,</span><span class="token string">"æå››"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"assignee2"</span><span class="token punctuation">,</span><span class="token string">"ç‹äº”"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"assignee3"</span><span class="token punctuation">,</span><span class="token string">"èµµè´¢åŠ¡"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å¯åŠ¨æµç¨‹å®ä¾‹ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æµç¨‹å®šä¹‰çš„id</span>
        <span class="token class-name">ProcessInstance</span> processInstance <span class="token operator">=</span> runtimeService
                <span class="token punctuation">.</span><span class="token function">startProcessInstanceById</span><span class="token punctuation">(</span><span class="token string">"evection:1:4"</span><span class="token punctuation">,</span>variables<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å¯åŠ¨æµç¨‹å®ä¾‹</span>
        <span class="token comment">// è¾“å‡ºç›¸å…³çš„æµç¨‹å®ä¾‹ä¿¡æ¯</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æµç¨‹å®šä¹‰çš„IDï¼š"</span> <span class="token operator">+</span> processInstance<span class="token punctuation">.</span><span class="token function">getProcessDefinitionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æµç¨‹å®ä¾‹çš„IDï¼š"</span> <span class="token operator">+</span> processInstance<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ´»åŠ¨çš„IDï¼š"</span> <span class="token operator">+</span> processInstance<span class="token punctuation">.</span><span class="token function">getActivityId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®Œæˆ Task ä»»åŠ¡ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥æŒ‡å®šæµç¨‹å˜é‡</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token doc-comment comment">/**
     * å®Œæˆä»»åŠ¡æ—¶æŒ‡å®šæµç¨‹å˜é‡
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">completeTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token comment">// è·å–æµç¨‹å¼•æ“å¯¹è±¡</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TaskService</span> taskService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getTaskService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Task</span> task <span class="token operator">=</span> taskService<span class="token punctuation">.</span><span class="token function">createTaskQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">processDefinitionId</span><span class="token punctuation">(</span><span class="token string">"evection:1:4"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">taskAssignee</span><span class="token punctuation">(</span><span class="token string">"æå››"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æ·»åŠ æµç¨‹å˜é‡</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> map <span class="token operator">=</span> task<span class="token punctuation">.</span><span class="token function">getProcessVariables</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"num"</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// å®Œæˆä»»åŠ¡</span>
        taskService<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨å¤„ç†æµç¨‹ä¹‹å¤–é€šè¿‡ Task ç¼–å·æ¥ä¿®æ”¹æµç¨‹å˜é‡</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token doc-comment comment">/**
     * é€šè¿‡å½“å‰ä»»åŠ¡è®¾ç½®
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">currentTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//   å½“å‰å¾…åŠä»»åŠ¡id</span>
        <span class="token comment">//  è·å–processEngine</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TaskService</span> taskService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getTaskService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Task</span> task <span class="token operator">=</span> taskService<span class="token punctuation">.</span><span class="token function">createTaskQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">processDefinitionId</span><span class="token punctuation">(</span><span class="token string">"evection:1:4"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">taskAssignee</span><span class="token punctuation">(</span><span class="token string">"ç‹äº”"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æ·»åŠ æµç¨‹å˜é‡</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> map <span class="token operator">=</span> task<span class="token punctuation">.</span><span class="token function">getProcessVariables</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"num"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//  ä¸€æ¬¡è®¾ç½®å¤šä¸ªå€¼ è®¾ç½®å±€éƒ¨å˜é‡</span>
        taskService<span class="token punctuation">.</span><span class="token function">setVariables</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="äºŒã€å€™é€‰äººå’Œå€™é€‰äººç»„" tabindex="-1"><a class="header-anchor" href="#äºŒã€å€™é€‰äººå’Œå€™é€‰äººç»„" aria-hidden="true">#</a> äºŒã€å€™é€‰äººå’Œå€™é€‰äººç»„</h1>
<p>â€ƒâ€ƒåœ¨æµç¨‹å®šä¹‰ä¸­åœ¨ä»»åŠ¡ç»“ç‚¹çš„ assignee å›ºå®šè®¾ç½®ä»»åŠ¡è´Ÿè´£äººï¼Œåœ¨æµç¨‹å®šä¹‰æ—¶å°†å‚ä¸è€…å›ºå®šè®¾ç½®åœ¨.bpmn æ–‡ä»¶ä¸­ï¼Œå¦‚æœä¸´æ—¶ä»»åŠ¡è´Ÿè´£äººå˜æ›´åˆ™éœ€è¦ä¿®æ”¹æµç¨‹å®šä¹‰ï¼Œç³»ç»Ÿå¯æ‰©å±•æ€§å·®ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µå¯ä»¥ç»™ä»»åŠ¡è®¾ç½®å¤šä¸ªå€™é€‰äººæˆ–è€…å€™é€‰äººç»„ï¼Œå¯ä»¥ä»å€™é€‰äººä¸­é€‰æ‹©å‚ä¸è€…æ¥å®Œæˆä»»åŠ¡ã€‚</p>
<h2 id="_1-å€™é€‰äºº" tabindex="-1"><a class="header-anchor" href="#_1-å€™é€‰äºº" aria-hidden="true">#</a> 1.å€™é€‰äºº</h2>
<h3 id="_1-1-å®šä¹‰æµç¨‹å›¾" tabindex="-1"><a class="header-anchor" href="#_1-1-å®šä¹‰æµç¨‹å›¾" aria-hidden="true">#</a> 1.1 å®šä¹‰æµç¨‹å›¾</h3>
<p>â€ƒâ€ƒå®šä¹‰æµç¨‹å›¾ï¼ŒåŒæ—¶æŒ‡å®šå€™é€‰äººï¼Œå¤šä¸ªå€™é€‰äººä¼šé€šè¿‡<code v-pre>,</code>è¿æ¥</p>
<p><img src="@source/notes/record/Flowableå…¥é—¨-é«˜çº§ç¯‡/assets/image-20220325095959489.png" alt="image-20220325095959489"></p>
<p><img src="@source/notes/record/Flowableå…¥é—¨-é«˜çº§ç¯‡/assets/image-20220325100835461.png" alt="image-20220325100835461"></p>
<h3 id="_1-2-éƒ¨ç½²å’Œå¯åŠ¨æµç¨‹å®ä¾‹" tabindex="-1"><a class="header-anchor" href="#_1-2-éƒ¨ç½²å’Œå¯åŠ¨æµç¨‹å®ä¾‹" aria-hidden="true">#</a> 1.2 éƒ¨ç½²å’Œå¯åŠ¨æµç¨‹å®ä¾‹</h3>
<p>â€ƒâ€ƒéƒ¨ç½²æµç¨‹ï¼Œå¹¶ä¸”åœ¨å¯åŠ¨æµç¨‹å®ä¾‹çš„æ—¶å€™å¯¹ UEL è¡¨è¾¾å¼èµ‹å€¼</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code>    <span class="token doc-comment comment">/**
     * éƒ¨ç½²æµç¨‹
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deploy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RepositoryService</span> repositoryService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRepositoryService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Deployment</span> deploy <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">createDeployment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addClasspathResource</span><span class="token punctuation">(</span><span class="token string">"è¯·å‡æµç¨‹-å€™é€‰äºº.bpmn20.xml"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">"è¯·æ±‚æµç¨‹-å€™é€‰äºº"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"deploy.getId() = "</span> <span class="token operator">+</span> deploy<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>deploy<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * å¯åŠ¨æµç¨‹å®ä¾‹
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">runProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RuntimeService</span> runtimeService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRuntimeService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ç»™æµç¨‹å®šä¹‰ä¸­çš„UELè¡¨è¾¾å¼èµ‹å€¼</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> variables <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"candidate1"</span><span class="token punctuation">,</span><span class="token string">"å¼ ä¸‰"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"candidate2"</span><span class="token punctuation">,</span><span class="token string">"æå››"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"candidate3"</span><span class="token punctuation">,</span><span class="token string">"ç‹äº”"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        runtimeService<span class="token punctuation">.</span><span class="token function">startProcessInstanceById</span><span class="token punctuation">(</span><span class="token string">"holiday-candidate:1:4"</span><span class="token punctuation">,</span>variables<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â€ƒâ€ƒåœ¨å¯¹åº”çš„è¡¨ç»“æ„ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æµç¨‹å˜é‡å·²ç»æœ‰äº†ï¼Œä½†æ˜¯å¯¹äºçš„ Task çš„ Assignee è¿˜æ˜¯ä¸ºç©ºã€‚</p>
<p><img src="@source/notes/record/Flowableå…¥é—¨-é«˜çº§ç¯‡/assets/image-20220325101054787.png" alt="image-20220325101054787"></p>
<p><img src="@source/notes/record/Flowableå…¥é—¨-é«˜çº§ç¯‡/assets/image-20220325102600573.png" alt="image-20220325102600573"></p>
<h3 id="_1-3-ä»»åŠ¡çš„æŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#_1-3-ä»»åŠ¡çš„æŸ¥è¯¢" aria-hidden="true">#</a> 1.3 ä»»åŠ¡çš„æŸ¥è¯¢</h3>
<p>â€ƒâ€ƒæ ¹æ®å½“å‰ç™»å½•çš„ç”¨æˆ·ï¼ŒæŸ¥è¯¢å¯¹åº”çš„å€™é€‰ä»»åŠ¡</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token doc-comment comment">/**
 * æ ¹æ®ç™»å½•çš„ç”¨æˆ·æŸ¥è¯¢å¯¹åº”çš„å¯ä»¥æ‹¾å–çš„ä»»åŠ¡
 *
 */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">queryTaskCandidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">TaskService</span> taskService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getTaskService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> taskService<span class="token punctuation">.</span><span class="token function">createTaskQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment">//.processInstanceId("2501")</span>
            <span class="token punctuation">.</span><span class="token function">processDefinitionId</span><span class="token punctuation">(</span><span class="token string">"holiday-candidate:1:4"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">taskCandidateUser</span><span class="token punctuation">(</span><span class="token string">"æå››"</span><span class="token punctuation">)</span> # æ³¨æ„
            <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Task</span> task <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"task.getId() = "</span> <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"task.getName() = "</span> <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-4-ä»»åŠ¡çš„æ‹¾å–" tabindex="-1"><a class="header-anchor" href="#_1-4-ä»»åŠ¡çš„æ‹¾å–" aria-hidden="true">#</a> 1.4 ä»»åŠ¡çš„æ‹¾å–</h3>
<p>â€ƒâ€ƒçŸ¥é“äº†æˆ‘æœ‰å¯æ‹¾å–çš„ä»»åŠ¡åï¼Œæ‹¾å–ä»»åŠ¡ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token doc-comment comment">/**
 * æ‹¾å–ä»»åŠ¡
 * ä¸€ä¸ªå€™é€‰äººæ‹¾å–äº†è¿™ä¸ªä»»åŠ¡ä¹‹åå…¶ä»–çš„ç”¨æˆ·å°±æ²¡æœ‰åŠæ³•æ‹¾å–è¿™ä¸ªä»»åŠ¡äº†
 * æ‰€ä»¥å¦‚æœä¸€ä¸ªç”¨æˆ·æ‹¾å–äº†ä»»åŠ¡ä¹‹ååˆä¸æƒ³å¤„ç†äº†ï¼Œé‚£ä¹ˆå¯ä»¥é€€è¿˜
 */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">claimTaskCandidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">TaskService</span> taskService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getTaskService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Task</span> task <span class="token operator">=</span> taskService<span class="token punctuation">.</span><span class="token function">createTaskQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment">//.processInstanceId("2501")</span>
            <span class="token punctuation">.</span><span class="token function">processDefinitionId</span><span class="token punctuation">(</span><span class="token string">"holiday-candidate:1:4"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">taskCandidateUser</span><span class="token punctuation">(</span><span class="token string">"æå››"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>task <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// æ‹¾å–å¯¹åº”çš„ä»»åŠ¡</span>
        taskService<span class="token punctuation">.</span><span class="token function">claim</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"æå››"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä»»åŠ¡æ‹¾å–æˆåŠŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="@source/notes/record/Flowableå…¥é—¨-é«˜çº§ç¯‡/assets/image-20220325103624344.png" alt="image-20220325103624344"></p>
<h3 id="_1-5-ä»»åŠ¡çš„å½’è¿˜" tabindex="-1"><a class="header-anchor" href="#_1-5-ä»»åŠ¡çš„å½’è¿˜" aria-hidden="true">#</a> 1.5 ä»»åŠ¡çš„å½’è¿˜</h3>
<p>â€ƒâ€ƒæ‹¾å–ä»»åŠ¡åä¸æƒ³æ“ä½œé‚£ä¹ˆå°±å½’è¿˜ä»»åŠ¡ï¼ˆç«™ç€èŒ…å‘ä¸æ‹‰å±ï¼‰</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token doc-comment comment">/**
 * é€€è¿˜ä»»åŠ¡
 * ä¸€ä¸ªå€™é€‰äººæ‹¾å–äº†è¿™ä¸ªä»»åŠ¡ä¹‹åå…¶ä»–çš„ç”¨æˆ·å°±æ²¡æœ‰åŠæ³•æ‹¾å–è¿™ä¸ªä»»åŠ¡äº†
 * æ‰€ä»¥å¦‚æœä¸€ä¸ªç”¨æˆ·æ‹¾å–äº†ä»»åŠ¡ä¹‹ååˆä¸æƒ³å¤„ç†äº†ï¼Œé‚£ä¹ˆå¯ä»¥é€€è¿˜
 */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">unclaimTaskCandidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">TaskService</span> taskService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getTaskService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Task</span> task <span class="token operator">=</span> taskService<span class="token punctuation">.</span><span class="token function">createTaskQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment">//.processInstanceId("2501")</span>
            <span class="token punctuation">.</span><span class="token function">processDefinitionId</span><span class="token punctuation">(</span><span class="token string">"holiday-candidate:1:4"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">taskAssignee</span><span class="token punctuation">(</span><span class="token string">"å¼ ä¸‰"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>task <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// æ‹¾å–å¯¹åº”çš„ä»»åŠ¡</span>
        taskService<span class="token punctuation">.</span><span class="token function">unclaim</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å½’è¿˜æ‹¾å–æˆåŠŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-6-ä»»åŠ¡çš„äº¤æ¥-å§”æ´¾" tabindex="-1"><a class="header-anchor" href="#_1-6-ä»»åŠ¡çš„äº¤æ¥-å§”æ´¾" aria-hidden="true">#</a> 1.6 ä»»åŠ¡çš„äº¤æ¥ï¼ˆå§”æ´¾ï¼‰</h3>
<p>â€ƒâ€ƒæ‹¾å–ä»»åŠ¡åå¦‚æœä¸æƒ³æ“ä½œä¹Ÿä¸æƒ³å½’è¿˜å¯ä»¥ç›´æ¥äº¤æ¥ï¼ˆå§”æ´¾ï¼‰ç»™å¦å¤–ä¸€ä¸ªäººæ¥å¤„ç†</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code>   <span class="token doc-comment comment">/**
     * ä»»åŠ¡çš„äº¤æ¥
     *    å¦‚æœæˆ‘è·å–äº†ä»»åŠ¡ï¼Œä½†æ˜¯ä¸æƒ³æ‰§è¡Œï¼Œé‚£ä¹ˆæˆ‘å¯ä»¥æŠŠè¿™ä¸ªä»»åŠ¡äº¤æ¥ç»™å…¶ä»–çš„ç”¨æˆ·
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">taskCandidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TaskService</span> taskService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getTaskService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Task</span> task <span class="token operator">=</span> taskService<span class="token punctuation">.</span><span class="token function">createTaskQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">//.processInstanceId("2501")</span>
                <span class="token punctuation">.</span><span class="token function">processDefinitionId</span><span class="token punctuation">(</span><span class="token string">"holiday-candidate:1:4"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">taskAssignee</span><span class="token punctuation">(</span><span class="token string">"æå››"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>task <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// ä»»åŠ¡çš„äº¤æ¥</span>
            taskService<span class="token punctuation">.</span><span class="token function">setAssignee</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"ç‹äº”"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä»»åŠ¡äº¤æ¥ç»™äº†ç‹äº”"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-7-ä»»åŠ¡çš„å®Œæˆ" tabindex="-1"><a class="header-anchor" href="#_1-7-ä»»åŠ¡çš„å®Œæˆ" aria-hidden="true">#</a> 1.7 ä»»åŠ¡çš„å®Œæˆ</h3>
<p>â€ƒâ€ƒæ­£å¸¸çš„ä»»åŠ¡å¤„ç†</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token doc-comment comment">/**
 * å®Œæˆä»»åŠ¡
 */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">completeTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">TaskService</span> taskService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getTaskService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Task</span> task <span class="token operator">=</span> taskService<span class="token punctuation">.</span><span class="token function">createTaskQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment">//.processInstanceId("2501")</span>
            <span class="token punctuation">.</span><span class="token function">processDefinitionId</span><span class="token punctuation">(</span><span class="token string">"holiday-candidate:1:4"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">taskAssignee</span><span class="token punctuation">(</span><span class="token string">"ç‹äº”"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>task <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// å®Œæˆä»»åŠ¡</span>
        taskService<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å®ŒæˆTask"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-å€™é€‰äººç»„" tabindex="-1"><a class="header-anchor" href="#_2-å€™é€‰äººç»„" aria-hidden="true">#</a> 2.å€™é€‰äººç»„</h2>
<p>â€ƒâ€ƒå½“å€™é€‰äººå¾ˆå¤šçš„æƒ…å†µä¸‹ï¼ˆæ¯”å¦‚æœ‰ä¸€ç™¾ä¸ªäººï¼Ÿä¸‰ç™¾ä¸ªäººï¼Ÿéš¾é“è¦ä¸€ä¸ªä¸€ä¸ªè®¾ç½®è¿›å»å—ï¼Ÿï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†ç»„æ¥å¤„ç†ã€‚å…ˆåˆ›å»ºç»„ï¼Œç„¶åæŠŠç”¨æˆ·åˆ†é…åˆ°è¿™ä¸ªç»„ä¸­ã€‚</p>
<h3 id="_2-1-ç®¡ç†ç”¨æˆ·å’Œç»„" tabindex="-1"><a class="header-anchor" href="#_2-1-ç®¡ç†ç”¨æˆ·å’Œç»„" aria-hidden="true">#</a> 2.1 ç®¡ç†ç”¨æˆ·å’Œç»„</h3>
<h4 id="_2-1-1-ç”¨æˆ·ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#_2-1-1-ç”¨æˆ·ç®¡ç†" aria-hidden="true">#</a> 2.1.1 ç”¨æˆ·ç®¡ç†</h4>
<p>â€ƒâ€ƒæˆ‘ä»¬éœ€è¦å…ˆå•ç‹¬ç»´æŠ¤ç”¨æˆ·ä¿¡æ¯ã€‚åå°å¯¹åº”çš„è¡¨ç»“æ„æ˜¯<code v-pre>ACT_ID_USER</code>.</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token doc-comment comment">/**
 * ç»´æŠ¤ç”¨æˆ·
 */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">createUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// é€šè¿‡ IdentityService å®Œæˆç›¸å…³çš„ç”¨æˆ·å’Œç»„çš„ç®¡ç†</span>
    <span class="token class-name">IdentityService</span> identityService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getIdentityService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// åˆ›å»ºç”¨æˆ·</span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> identityService<span class="token punctuation">.</span><span class="token function">newUser</span><span class="token punctuation">(</span><span class="token string">"ç”°ä½³"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setFirstName</span><span class="token punctuation">(</span><span class="token string">"tian"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setLastName</span><span class="token punctuation">(</span><span class="token string">"jia"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setEmail</span><span class="token punctuation">(</span><span class="token string">"tianjia@qq.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ä¿å­˜ç”¨æˆ·</span>
    identityService<span class="token punctuation">.</span><span class="token function">saveUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="@source/notes/record/Flowableå…¥é—¨-é«˜çº§ç¯‡/assets/image-20220325110324815.png" alt="image-20220325110324815"></p>
<blockquote>
<p>é—®é¢˜ï¼šå¦‚ä½•å°†ç³»ç»Ÿå†…çš„ç”¨æˆ·è¡¨(æ¯”å¦‚ sys_user ç­‰ç­‰)è·Ÿ flowable ä¸­çš„ act_id_user è¡¨è¿›è¡Œå…³è”å‘¢ï¼Ÿ</p>
<p>ç”¨æˆ·åœ¨ç³»ç»Ÿè¿›è¡Œæ³¨å†Œçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥å‘ act_id_user è¿›è¡Œå†™å…¥æ•°æ®ä¿æ¥è¯æ•°æ®çš„åŸå­æ€§</p>
<p>å½“ç„¶æ›´æ–°çš„æ—¶å€™ä¹Ÿéœ€è¦è¿›è¡ŒåŒæ­¥çš„æ›´æ–°</p>
</blockquote>
<h4 id="_2-1-2-group-ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#_2-1-2-group-ç®¡ç†" aria-hidden="true">#</a> 2.1.2 Group ç®¡ç†</h4>
<p>â€ƒâ€ƒç»´æŠ¤å¯¹åº”çš„ Group ä¿¡æ¯ï¼Œåå°å¯¹åº”çš„è¡¨ç»“æ„æ˜¯<code v-pre>ACT_ID_GROUP</code></p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token doc-comment comment">/**
 * åˆ›å»ºç”¨æˆ·ç»„
 */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">createGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">IdentityService</span> identityService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getIdentityService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// åˆ›å»ºGroupå¯¹è±¡å¹¶æŒ‡å®šç›¸å…³çš„ä¿¡æ¯</span>
    <span class="token class-name">Group</span> group <span class="token operator">=</span> identityService<span class="token punctuation">.</span><span class="token function">newGroup</span><span class="token punctuation">(</span><span class="token string">"group2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    group<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"å¼€å‘éƒ¨"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    group<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token string">"type1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ä¿å­˜Groupå¯¹åº”çš„è¡¨ç»“æ„æ•°æ®</span>
    identityService<span class="token punctuation">.</span><span class="token function">saveGroup</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="@source/notes/record/Flowableå…¥é—¨-é«˜çº§ç¯‡/assets/image-20220325110408435.png" alt="image-20220325110408435"></p>
<h4 id="_2-1-3-ç”¨æˆ·åˆ†é…ç»„" tabindex="-1"><a class="header-anchor" href="#_2-1-3-ç”¨æˆ·åˆ†é…ç»„" aria-hidden="true">#</a> 2.1.3 ç”¨æˆ·åˆ†é…ç»„</h4>
<p>â€ƒâ€ƒç”¨æˆ·å’Œç»„æ˜¯ä¸€ä¸ªå¤šå¯¹å¤šçš„å…³è”å…³è”ï¼Œæˆ‘ä»¬éœ€è¦åšç›¸å…³çš„åˆ†é…ï¼Œåå°å¯¹åº”çš„è¡¨ç»“æ„æ˜¯<code v-pre>ACT_ID_MEMBERSHIP</code></p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token doc-comment comment">/**
 * å°†ç”¨æˆ·åˆ†é…ç»™å¯¹åº”çš„Group
 */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">userGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">IdentityService</span> identityService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getIdentityService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// æ ¹æ®ç»„çš„ç¼–å·æ‰¾åˆ°å¯¹åº”çš„Groupå¯¹è±¡</span>
    <span class="token class-name">Group</span> group <span class="token operator">=</span> identityService<span class="token punctuation">.</span><span class="token function">createGroupQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">groupId</span><span class="token punctuation">(</span><span class="token string">"group1"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> identityService
            <span class="token punctuation">.</span><span class="token function">createUserQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">User</span> user <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å°†ç”¨æˆ·åˆ†é…ç»™å¯¹åº”çš„ç»„</span>
        identityService<span class="token punctuation">.</span><span class="token function">createMembership</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> group<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//            System.out.println(user.getId()); // æ‰“å°ç”¨æˆ·ä¿¡æ¯</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="@source/notes/record/Flowableå…¥é—¨-é«˜çº§ç¯‡/assets/image-20220325110511848.png" alt="image-20220325110511848"></p>
<h3 id="_2-2-å€™é€‰äººç»„åº”ç”¨" tabindex="-1"><a class="header-anchor" href="#_2-2-å€™é€‰äººç»„åº”ç”¨" aria-hidden="true">#</a> 2.2 å€™é€‰äººç»„åº”ç”¨</h3>
<p>â€ƒâ€ƒææ¸…æ¥šäº†ç”¨æˆ·å’Œç”¨æˆ·ç»„çš„å…³ç³»åæˆ‘ä»¬å°±å¯ä»¥æ¥ä½¿ç”¨å€™é€‰äººç»„çš„åº”ç”¨äº†</p>
<h4 id="_2-2-1-åˆ›å»ºæµç¨‹å›¾" tabindex="-1"><a class="header-anchor" href="#_2-2-1-åˆ›å»ºæµç¨‹å›¾" aria-hidden="true">#</a> 2.2.1 åˆ›å»ºæµç¨‹å›¾</h4>
<p><img src="@source/notes/record/Flowableå…¥é—¨-é«˜çº§ç¯‡/assets/image-20220325111013641.png" alt="image-20220325111013641"></p>
<p><img src="@source/notes/record/Flowableå…¥é—¨-é«˜çº§ç¯‡/assets/image-20220325110952527.png" alt="image-20220325110952527"></p>
<h4 id="_2-2-2-æµç¨‹çš„éƒ¨ç½²è¿è¡Œ" tabindex="-1"><a class="header-anchor" href="#_2-2-2-æµç¨‹çš„éƒ¨ç½²è¿è¡Œ" aria-hidden="true">#</a> 2.2.2 æµç¨‹çš„éƒ¨ç½²è¿è¡Œ</h4>
<p>â€ƒâ€ƒç„¶åæˆ‘ä»¬æŠŠæµç¨‹éƒ¨ç½²å’Œè¿è¡Œï¼Œæ³¨æ„å¯¹ UEL è¡¨è¾¾å¼èµ‹å€¼ï¼Œå…³è”ä¸Š Group</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token doc-comment comment">/**
 * éƒ¨ç½²æµç¨‹
 */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deploy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">RepositoryService</span> repositoryService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRepositoryService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Deployment</span> deploy <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">createDeployment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">addClasspathResource</span><span class="token punctuation">(</span><span class="token string">"è¯·å‡æµç¨‹-å€™é€‰äººç»„.bpmn20.xml"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">"Testè¯·æ±‚æµç¨‹-å€™é€‰äººç»„"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"deploy.getId() = "</span> <span class="token operator">+</span> deploy<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>deploy<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * åˆ é™¤æµç¨‹å®šä¹‰
 */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDeleteDeploy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">RepositoryService</span> repositoryService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRepositoryService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// åˆ é™¤éƒ¨ç½²çš„æµç¨‹ ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ id  å¦‚æœéƒ¨ç½²çš„æµç¨‹å¯åŠ¨äº†å°±ä¸å…è®¸åˆ é™¤äº†(æŠ¥é”™)</span>
    <span class="token comment">// repositoryService.deleteDeployment("2501");</span>
    <span class="token comment">// ç¬¬äºŒä¸ªå‚æ•°æ˜¯çº§è”åˆ é™¤ï¼Œå¦‚æœæµç¨‹å¯åŠ¨äº† ç›¸å…³çš„ä»»åŠ¡ä¹Ÿä¼šä¸€å¹¶ä¼šè¢«åˆ é™¤æ‰ (å¼ºåˆ¶åˆ é™¤)</span>
    repositoryService<span class="token punctuation">.</span><span class="token function">deleteDeployment</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"åˆ é™¤æˆåŠŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * å¯åŠ¨æµç¨‹å®ä¾‹
 */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">runProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">IdentityService</span> identityService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getIdentityService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// è·å–æ‰€æœ‰çš„ä¿¡æ¯</span>
    <span class="token class-name">Group</span> group <span class="token operator">=</span> identityService
            <span class="token punctuation">.</span><span class="token function">createGroupQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">groupId</span><span class="token punctuation">(</span><span class="token string">"group1"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">RuntimeService</span> runtimeService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRuntimeService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ç»™æµç¨‹å®šä¹‰ä¸­çš„UELè¡¨è¾¾å¼èµ‹å€¼</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> variables <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// variables.put("g1","group1");</span>
    variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"g1"</span><span class="token punctuation">,</span> group<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç»™æµç¨‹å®šä¹‰ä¸­çš„UELè¡¨è¾¾å¼èµ‹å€¼</span>
    runtimeService<span class="token punctuation">.</span><span class="token function">startProcessInstanceById</span><span class="token punctuation">(</span><span class="token string">"holiday-group:1:2504"</span><span class="token punctuation">,</span> variables<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯¹åº”è¡¨ç»“æ„ä¸­å°±æœ‰å¯¹åº”çš„ä½“ç°</p>
<p><img src="@source/notes/record/Flowableå…¥é—¨-é«˜çº§ç¯‡/assets/image-20220325112545719.png" alt="image-20220325112545719"></p>
<h4 id="_2-2-3-ä»»åŠ¡çš„æ‹¾å–å’Œå®Œæˆ" tabindex="-1"><a class="header-anchor" href="#_2-2-3-ä»»åŠ¡çš„æ‹¾å–å’Œå®Œæˆ" aria-hidden="true">#</a> 2.2.3 ä»»åŠ¡çš„æ‹¾å–å’Œå®Œæˆ</h4>
<p>â€ƒâ€ƒç„¶åå®Œæˆä»»åŠ¡çš„æŸ¥è¯¢æ‹¾å–å’Œå¤„ç†æ“ä½œ</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token doc-comment comment">/**
 * æ ¹æ®ç™»å½•çš„ç”¨æˆ·æŸ¥è¯¢å¯¹åº”çš„å¯ä»¥æ‹¾å–çš„ä»»åŠ¡
 *
 */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">queryTaskCandidateGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// æ ¹æ®å½“å‰ç™»å½•çš„ç”¨æˆ·æ‰¾åˆ°å¯¹åº”çš„ç»„</span>
    <span class="token class-name">IdentityService</span> identityService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getIdentityService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// å½“å‰ç”¨æˆ·æ‰€åœ¨çš„ç»„</span>
    <span class="token class-name">Group</span> group <span class="token operator">=</span> identityService<span class="token punctuation">.</span><span class="token function">createGroupQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">groupMember</span><span class="token punctuation">(</span><span class="token string">"é‚“å½ª"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">TaskService</span> taskService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getTaskService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// æ ¹æ®ç»„çš„ç¼–å·æ¥æ‰¾åˆ° åˆ†é…ç»™æ”¹ç»„çš„ä»»åŠ¡åˆ—è¡¨</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> taskService<span class="token punctuation">.</span><span class="token function">createTaskQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment">//.processInstanceId("2501")</span>
            <span class="token punctuation">.</span><span class="token function">processDefinitionId</span><span class="token punctuation">(</span><span class="token string">"holiday-group:1:17504"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">taskCandidateGroup</span><span class="token punctuation">(</span>group<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Task</span> task <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"task.getId() = "</span> <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"task.getName() = "</span> <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * æ‹¾å–ä»»åŠ¡
 *    ä¸€ä¸ªå€™é€‰äººæ‹¾å–äº†è¿™ä¸ªä»»åŠ¡ä¹‹åå…¶ä»–çš„ç”¨æˆ·å°±æ²¡æœ‰åŠæ³•æ‹¾å–è¿™ä¸ªä»»åŠ¡äº†
 *    æ‰€ä»¥å¦‚æœä¸€ä¸ªç”¨æˆ·æ‹¾å–äº†ä»»åŠ¡ä¹‹ååˆä¸æƒ³å¤„ç†äº†ï¼Œé‚£ä¹ˆå¯ä»¥é€€è¿˜
 */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">claimTaskCandidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">String</span> userId <span class="token operator">=</span> <span class="token string">"ç”°ä½³"</span><span class="token punctuation">;</span>
    <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// æ ¹æ®å½“å‰ç™»å½•çš„ç”¨æˆ·æ‰¾åˆ°å¯¹åº”çš„ç»„</span>
    <span class="token class-name">IdentityService</span> identityService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getIdentityService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// å½“å‰ç”¨æˆ·æ‰€åœ¨çš„ç»„</span>
    <span class="token class-name">Group</span> group <span class="token operator">=</span> identityService<span class="token punctuation">.</span><span class="token function">createGroupQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">groupMember</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">TaskService</span> taskService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getTaskService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Task</span> task <span class="token operator">=</span> taskService<span class="token punctuation">.</span><span class="token function">createTaskQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment">//.processInstanceId("2501")</span>
            <span class="token punctuation">.</span><span class="token function">processDefinitionId</span><span class="token punctuation">(</span><span class="token string">"holiday-group:1:17504"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">taskCandidateGroup</span><span class="token punctuation">(</span>group<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>task <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ä»»åŠ¡æ‹¾å–</span>
        taskService<span class="token punctuation">.</span><span class="token function">claim</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä»»åŠ¡æ‹¾å–æˆåŠŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token doc-comment comment">/**
 * å®Œæˆä»»åŠ¡
 */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">completeTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">TaskService</span> taskService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getTaskService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Task</span> task <span class="token operator">=</span> taskService<span class="token punctuation">.</span><span class="token function">createTaskQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment">//.processInstanceId("2501")</span>
            <span class="token punctuation">.</span><span class="token function">processDefinitionId</span><span class="token punctuation">(</span><span class="token string">"holiday-group:1:2504"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">taskAssignee</span><span class="token punctuation">(</span><span class="token string">"lisi"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>task <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å®Œæˆä»»åŠ¡</span>
        taskService<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"task.getId() = "</span> <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"task.getName() = "</span> <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å®ŒæˆTask"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="ä¸‰ã€ç½‘å…³" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€ç½‘å…³" aria-hidden="true">#</a> ä¸‰ã€ç½‘å…³</h1>
<blockquote>
<p>ç½‘å…³æ˜¯ç”¨æ¥æ§åˆ¶æµç¨‹çš„æµå‘</p>
</blockquote>
<h2 id="_1-æ’ä»–ç½‘å…³" tabindex="-1"><a class="header-anchor" href="#_1-æ’ä»–ç½‘å…³" aria-hidden="true">#</a> 1.æ’ä»–ç½‘å…³</h2>
<p>â€ƒâ€ƒæ’ä»–ç½‘å…³ï¼ˆexclusive gatewayï¼‰ï¼ˆä¹Ÿå«<em>å¼‚æˆ–ç½‘å…³ XOR gateway</em>ï¼Œæˆ–è€…æ›´ä¸“ä¸šçš„ï¼Œ<em>åŸºäºæ•°æ®çš„æ’ä»–ç½‘å…³ exclusive data-based gateway</em>ï¼‰ï¼Œç”¨äºå¯¹æµç¨‹ä¸­çš„<strong>å†³ç­–</strong>å»ºæ¨¡ã€‚å½“æ‰§è¡Œåˆ°è¾¾è¿™ä¸ªç½‘å…³æ—¶ï¼Œä¼šæŒ‰ç…§æ‰€æœ‰å‡ºå£é¡ºåºæµå®šä¹‰çš„é¡ºåºå¯¹å®ƒä»¬è¿›è¡Œè®¡ç®—ã€‚é€‰æ‹©ç¬¬ä¸€ä¸ªæ¡ä»¶è®¡ç®—ä¸º true çš„é¡ºåºæµï¼ˆå½“æ²¡æœ‰è®¾ç½®æ¡ä»¶æ—¶ï¼Œè®¤ä¸ºé¡ºåºæµä¸º<em>true</em>ï¼‰ç»§ç»­æµç¨‹ã€‚</p>
<p>â€ƒâ€ƒ<strong>è¯·æ³¨æ„è¿™é‡Œå‡ºå£é¡ºåºæµçš„å«ä¹‰ä¸ BPMN 2.0 ä¸­çš„ä¸€èˆ¬æƒ…å†µä¸ä¸€æ ·ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¼šé€‰æ‹©æ‰€æœ‰æ¡ä»¶è®¡ç®—ä¸º true çš„é¡ºåºæµï¼Œå¹¶è¡Œæ‰§è¡Œã€‚è€Œä½¿ç”¨æ’ä»–ç½‘å…³æ—¶ï¼Œåªä¼šé€‰æ‹©ä¸€æ¡é¡ºåºæµã€‚å½“å¤šæ¡é¡ºåºæµçš„æ¡ä»¶éƒ½è®¡ç®—ä¸º true æ—¶ï¼Œä¼šä¸”ä»…ä¼šé€‰æ‹©åœ¨ XML ä¸­æœ€å…ˆå®šä¹‰çš„é¡ºåºæµç»§ç»­æµç¨‹ã€‚å¦‚æœæ²¡æœ‰å¯é€‰çš„é¡ºåºæµï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</strong></p>
<p>å›¾ç¤º</p>
<p>â€ƒâ€ƒæ’ä»–ç½‘å…³ç”¨å†…éƒ¨å¸¦æœ‰â€™Xâ€™å›¾æ ‡çš„æ ‡å‡†ç½‘å…³ï¼ˆè±å½¢ï¼‰è¡¨ç¤ºï¼Œ'Xâ€™å›¾æ ‡ä»£è¡¨<em>å¼‚æˆ–</em>çš„å«ä¹‰ã€‚è¯·æ³¨æ„å†…éƒ¨æ²¡æœ‰å›¾æ ‡çš„ç½‘å…³é»˜è®¤ä¸ºæ’ä»–ç½‘å…³ã€‚BPMN 2.0 è§„èŒƒä¸å…è®¸åœ¨åŒä¸€ä¸ªæµç¨‹ä¸­æ··åˆä½¿ç”¨æœ‰åŠæ²¡æœ‰ X çš„è±å½¢æ ‡å¿—ã€‚</p>
<p><img src="@source/notes/record/Flowableå…¥é—¨-é«˜çº§ç¯‡/assets/image-20220326100630908.png" alt="image-20220326100630908"></p>
<p>æ¡ˆä¾‹ï¼š</p>
<p><img src="@source/notes/record/Flowableå…¥é—¨-é«˜çº§ç¯‡/assets/image-20220326103951903.png" alt="image-20220326103951903"></p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code>   <span class="token doc-comment comment">/**
     * éƒ¨ç½²æµç¨‹
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deploy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RepositoryService</span> repositoryService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRepositoryService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Deployment</span> deploy <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">createDeployment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addClasspathResource</span><span class="token punctuation">(</span><span class="token string">"è¯·å‡æµç¨‹-æ’ä»–ç½‘å…³.bpmn20.xml"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">"è¯·æ±‚æµç¨‹-æ’ä»–ç½‘å…³"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"deploy.getId() = "</span> <span class="token operator">+</span> deploy<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>deploy<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * å¯åŠ¨æµç¨‹å®ä¾‹
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">runProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RuntimeService</span> runtimeService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRuntimeService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ç»™æµç¨‹å®šä¹‰ä¸­çš„UELè¡¨è¾¾å¼èµ‹å€¼</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> variables <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// variables.put("g1","group1");</span>
        variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"num"</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç»™æµç¨‹å®šä¹‰ä¸­çš„UELè¡¨è¾¾å¼èµ‹å€¼</span>
        runtimeService<span class="token punctuation">.</span><span class="token function">startProcessInstanceById</span><span class="token punctuation">(</span><span class="token string">"holiday-exclusive:1:4"</span><span class="token punctuation">,</span>variables<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token doc-comment comment">/**
     * å¯åŠ¨æµç¨‹å®ä¾‹
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setVariables</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RuntimeService</span> runtimeService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRuntimeService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ç»™æµç¨‹å®šä¹‰ä¸­çš„UELè¡¨è¾¾å¼èµ‹å€¼</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> variables <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// variables.put("g1","group1");</span>
        variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"num"</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç»™æµç¨‹å®šä¹‰ä¸­çš„UELè¡¨è¾¾å¼èµ‹å€¼</span>
        runtimeService<span class="token punctuation">.</span><span class="token function">setVariables</span><span class="token punctuation">(</span><span class="token string">"12503"</span><span class="token punctuation">,</span>variables<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>



    <span class="token doc-comment comment">/**
     * å®Œæˆä»»åŠ¡
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">completeTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TaskService</span> taskService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getTaskService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Task</span> task <span class="token operator">=</span> taskService<span class="token punctuation">.</span><span class="token function">createTaskQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">//.processInstanceId("2501")</span>
                <span class="token punctuation">.</span><span class="token function">processDefinitionId</span><span class="token punctuation">(</span><span class="token string">"holiday-exclusive:1:4"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">taskAssignee</span><span class="token punctuation">(</span><span class="token string">"zhangsan"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>task <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// å®Œæˆä»»åŠ¡</span>
            taskService<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å®ŒæˆTask"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœä»ç½‘å…³å‡ºå»çš„çº¿æ‰€æœ‰æ¡ä»¶éƒ½ä¸æ»¡è¶³çš„æƒ…å†µä¸‹ä¼šæŠ›å‡ºç³»ç»Ÿå¼‚å¸¸ï¼Œ</p>
<p><img src="@source/notes/record/Flowableå…¥é—¨-é«˜çº§ç¯‡/assets/image-20220326104744181.png" alt="image-20220326104744181"></p>
<p>ä½†æ˜¯è¦æ³¨æ„ä»»åŠ¡æ²¡æœ‰ç»“æŸï¼Œè¿˜æ˜¯åŸæ¥çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥é‡ç½®æµç¨‹å˜é‡</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setVariables</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">RuntimeService</span> runtimeService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRuntimeService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ç»™æµç¨‹å®šä¹‰ä¸­çš„UELè¡¨è¾¾å¼èµ‹å€¼</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> variables <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// variables.put("g1","group1");</span>
    variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"num"</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç»™æµç¨‹å®šä¹‰ä¸­çš„UELè¡¨è¾¾å¼èµ‹å€¼</span>
    runtimeService<span class="token punctuation">.</span><span class="token function">setVariables</span><span class="token punctuation">(</span><span class="token string">"12503"</span><span class="token punctuation">,</span>variables<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote>
<p>å‰é¢æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨è¿æ¥çº¿ä¸Šå®šä¹‰æ¡ä»¶ï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜è¦æœ‰æ’ä»–ç½‘å…³å‘¢ï¼Ÿ</p>
<ul>
<li>
<p>ç›´æ¥åœ¨çº¿ä¸Šçš„æƒ…å†µï¼Œå¦‚æœæ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œæµç¨‹å°±ç»“æŸäº†ï¼Œæ˜¯å¼‚å¸¸ç»“æŸ!!</p>
</li>
<li>
<p>ç„¶è€Œåœ¨ç½‘å…³å±‚é¢çš„è¯ï¼Œå¦‚æœæ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œä»–åªæ˜¯æŠ›å‡ºäº†ä¸€ä¸ªå¼‚å¸¸ï¼Œä½†æµç¨‹æ²¡æœ‰ç»“æŸï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­å¯¹æµç¨‹æ“ä½œï¼ˆæ¯”å¦‚ä¸Šé¢æ¡ˆä¾‹ä¸­ ä¿®æ”¹å˜é‡(è¯·å‡å¤©æ•°)ï¼‰</p>
</li>
</ul>
</blockquote>
<h2 id="_2-å¹¶è¡Œç½‘å…³" tabindex="-1"><a class="header-anchor" href="#_2-å¹¶è¡Œç½‘å…³" aria-hidden="true">#</a> 2.å¹¶è¡Œç½‘å…³</h2>
<p>â€ƒâ€ƒå¹¶è¡Œç½‘å…³å…è®¸å°†æµç¨‹åˆ†æˆå¤šæ¡åˆ†æ”¯ï¼Œä¹Ÿå¯ä»¥æŠŠå¤šæ¡åˆ†æ”¯æ±‡èšåˆ°ä¸€èµ·ï¼Œå¹¶è¡Œç½‘å…³çš„åŠŸèƒ½æ˜¯åŸºäºè¿›å…¥å’Œå¤–å‡ºé¡ºåºæµçš„ï¼š</p>
<ul>
<li>
<p>fork åˆ†æ”¯ï¼šå¹¶è¡Œåçš„æ‰€æœ‰å¤–å‡ºé¡ºåºæµï¼Œä¸ºæ¯ä¸ªé¡ºåºæµéƒ½åˆ›å»ºä¸€ä¸ªå¹¶å‘åˆ†æ”¯ã€‚</p>
</li>
<li>
<p>join æ±‡èšï¼š æ‰€æœ‰åˆ°è¾¾å¹¶è¡Œç½‘å…³ï¼Œåœ¨æ­¤ç­‰å¾…çš„è¿›å…¥åˆ†æ”¯ï¼Œ ç›´åˆ°æ‰€æœ‰è¿›å…¥é¡ºåºæµçš„åˆ†æ”¯éƒ½åˆ°è¾¾ä»¥åï¼Œ æµç¨‹å°±ä¼šé€šè¿‡æ±‡èšç½‘å…³ã€‚</p>
</li>
</ul>
<p>â€ƒâ€ƒæ³¨æ„ï¼Œå¦‚æœåŒä¸€ä¸ªå¹¶è¡Œç½‘å…³æœ‰å¤šä¸ªè¿›å…¥å’Œå¤šä¸ªå¤–å‡ºé¡ºåºæµï¼Œ å®ƒå°±åŒæ—¶å…·æœ‰åˆ†æ”¯å’Œæ±‡èšåŠŸèƒ½ã€‚<code v-pre> è¿™æ—¶ï¼Œç½‘å…³ä¼šå…ˆæ±‡èšæ‰€æœ‰è¿›å…¥çš„é¡ºåºæµï¼Œç„¶åå†åˆ‡åˆ†æˆå¤šä¸ªå¹¶è¡Œåˆ†æ”¯ã€‚</code></p>
<p><strong>ä¸å…¶ä»–ç½‘å…³çš„ä¸»è¦åŒºåˆ«æ˜¯ï¼Œå¹¶è¡Œç½‘å…³ä¸ä¼šè§£ææ¡ä»¶ã€‚</strong> <strong>å³ä½¿é¡ºåºæµä¸­å®šä¹‰äº†æ¡ä»¶ï¼Œä¹Ÿä¼šè¢«å¿½ç•¥ã€‚</strong></p>
<blockquote>
<p>æ¯”å¦‚è¯´ è¯·å‡ç”³è¯·éœ€è¦ éƒ¨é—¨ç»ç†&amp;æŠ€æœ¯ç»ç†å…±åŒå®¡æ‰¹</p>
</blockquote>
<p>æ¡ˆä¾‹ï¼š</p>
<p><img src="@source/notes/record/Flowableå…¥é—¨-é«˜çº§ç¯‡/assets/image-20220326110341232.png" alt="image-20220326110341232"></p>
<p>å½“æˆ‘ä»¬æ‰§è¡Œäº†åˆ›å»ºè¯·å‡å•åï¼Œåˆ°å¹¶è¡Œç½‘å…³çš„ä½ç½®çš„æ—¶å€™ï¼Œåœ¨ ACT_RU_TASK è¡¨ä¸­å°±æœ‰ä¸¤æ¡è®°å½•</p>
<p><img src="@source/notes/record/Flowableå…¥é—¨-é«˜çº§ç¯‡/assets/image-20220326111359504.png" alt="image-20220326111359504"></p>
<p>ç„¶ååŒæ—¶åœ¨ ACT_RU_EXECUTION ä¸­æœ‰ä¸‰æ¡è®°å½•ï¼Œä¸€ä¸ªä»»åŠ¡å¯¹åº”çš„æœ‰ä¸¤ä¸ªæ‰§è¡Œå®ä¾‹</p>
<p><img src="@source/notes/record/Flowableå…¥é—¨-é«˜çº§ç¯‡/assets/image-20220326111453630.png" alt="image-20220326111453630"></p>
<h2 id="_3-åŒ…å«ç½‘å…³" tabindex="-1"><a class="header-anchor" href="#_3-åŒ…å«ç½‘å…³" aria-hidden="true">#</a> 3.åŒ…å«ç½‘å…³</h2>
<p>â€ƒåŒ…å«ç½‘å…³å¯ä»¥çœ‹åšæ˜¯æ’ä»–ç½‘å…³å’Œå¹¶è¡Œç½‘å…³çš„ç»“åˆä½“ã€‚ å’Œæ’ä»–ç½‘å…³ä¸€æ ·ï¼Œä½ å¯ä»¥åœ¨å¤–å‡ºé¡ºåºæµä¸Šå®šä¹‰æ¡ä»¶ï¼ŒåŒ…å«ç½‘å…³ä¼šè§£æå®ƒä»¬ã€‚ ä½†æ˜¯ä¸»è¦çš„åŒºåˆ«æ˜¯åŒ…å«ç½‘å…³å¯ä»¥é€‰æ‹©å¤šäºä¸€æ¡é¡ºåºæµï¼Œè¿™å’Œå¹¶è¡Œç½‘å…³ä¸€æ ·ã€‚</p>
<p>åŒ…å«ç½‘å…³çš„åŠŸèƒ½æ˜¯åŸºäºè¿›å…¥å’Œå¤–å‡ºé¡ºåºæµçš„ï¼š</p>
<ul>
<li>åˆ†æ”¯ï¼š æ‰€æœ‰å¤–å‡ºé¡ºåºæµçš„æ¡ä»¶éƒ½ä¼šè¢«è§£æï¼Œç»“æœä¸º true çš„é¡ºåºæµä¼šä»¥å¹¶è¡Œæ–¹å¼ç»§ç»­æ‰§è¡Œï¼Œ ä¼šä¸ºæ¯ä¸ªé¡ºåºæµåˆ›å»ºä¸€ä¸ªåˆ†æ”¯ã€‚</li>
<li>æ±‡èšï¼šæ‰€æœ‰å¹¶è¡Œåˆ†æ”¯åˆ°è¾¾åŒ…å«ç½‘å…³ï¼Œä¼šè¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œ ç›´åˆ°æ¯ä¸ªåŒ…å«æµç¨‹ token çš„è¿›å…¥é¡ºåºæµçš„åˆ†æ”¯éƒ½åˆ°è¾¾ã€‚ è¿™æ˜¯ä¸å¹¶è¡Œç½‘å…³çš„æœ€å¤§ä¸åŒã€‚æ¢å¥è¯è¯´ï¼ŒåŒ…å«ç½‘å…³åªä¼šç­‰å¾…è¢«é€‰ä¸­æ‰§è¡Œäº†çš„è¿›å…¥é¡ºåºæµã€‚ åœ¨æ±‡èšä¹‹åï¼Œæµç¨‹ä¼šç©¿è¿‡åŒ…å«ç½‘å…³ç»§ç»­æ‰§è¡Œã€‚</li>
</ul>
<blockquote>
<p>æ¯”å¦‚ï¼šç”³è¯·æµç¨‹å¼€å§‹ äº¤ç»™æŠ€æœ¯ç»ç† æˆ–è€… é¡¹ç›®ç»ç†ä»»å…¶ä¸€ä¸ªè¿›è¡Œå®¡æ‰¹ ä½†æ˜¯ ä¸€å®šä¼šæµè½¬åˆ° äººäº‹è¿›è¡Œå®¡æ‰¹</p>
<p>ä¹Ÿå°±æ˜¯è¯´ ä¸ç®¡æ€ä¹ˆèµ° éƒ½ä¼šäº¤ç»™äººäº‹è¿›è¡Œå®¡æ‰¹</p>
</blockquote>
<p><img src="@source/notes/record/Flowableå…¥é—¨-é«˜çº§ç¯‡/assets/image-20220326112720089.png" alt="image-20220326112720089"></p>
<h2 id="_4-äº‹ä»¶ç½‘å…³" tabindex="-1"><a class="header-anchor" href="#_4-äº‹ä»¶ç½‘å…³" aria-hidden="true">#</a> 4.äº‹ä»¶ç½‘å…³</h2>
<p>â€ƒâ€ƒäº‹ä»¶ç½‘å…³å…è®¸æ ¹æ®äº‹ä»¶åˆ¤æ–­æµå‘ã€‚ç½‘å…³çš„æ¯ä¸ªå¤–å‡ºé¡ºåºæµéƒ½è¦è¿æ¥åˆ°ä¸€ä¸ªä¸­é—´æ•è·äº‹ä»¶ã€‚ å½“æµç¨‹åˆ°è¾¾ä¸€ä¸ªåŸºäºäº‹ä»¶ç½‘å…³ï¼Œç½‘å…³ä¼šè¿›å…¥ç­‰å¾…çŠ¶æ€ï¼šä¼šæš‚åœæ‰§è¡Œã€‚ä¸æ­¤åŒæ—¶ï¼Œä¼šä¸ºæ¯ä¸ªå¤–å‡ºé¡ºåºæµåˆ›å»ºç›¸å¯¹çš„äº‹ä»¶è®¢é˜…ã€‚</p>
<p>â€ƒâ€ƒäº‹ä»¶ç½‘å…³çš„å¤–å‡ºé¡ºåºæµå’Œæ™®é€šé¡ºåºæµä¸åŒï¼Œè¿™äº›é¡ºåºæµä¸ä¼šçœŸçš„&quot;æ‰§è¡Œ&quot;ï¼Œ ç›¸åå®ƒä»¬è®©æµç¨‹å¼•æ“å»å†³å®šæ‰§è¡Œåˆ°äº‹ä»¶ç½‘å…³çš„æµç¨‹éœ€è¦è®¢é˜…å“ªäº›äº‹ä»¶ã€‚ è¦è€ƒè™‘ä»¥ä¸‹æ¡ä»¶ï¼š</p>
<ol>
<li>äº‹ä»¶ç½‘å…³å¿…é¡»æœ‰ä¸¤æ¡æˆ–ä»¥ä¸Šå¤–å‡ºé¡ºåºæµï¼›</li>
<li>äº‹ä»¶ç½‘å…³åï¼Œåªèƒ½ä½¿ç”¨ intermediateCatchEvent ç±»å‹ï¼ˆactiviti ä¸æ”¯æŒåŸºäºäº‹ä»¶ç½‘å…³åè¿æ¥ ReceiveTaskï¼‰</li>
<li>è¿æ¥åˆ°äº‹ä»¶ç½‘å…³çš„ä¸­é—´æ•è·äº‹ä»¶å¿…é¡»åªæœ‰ä¸€ä¸ªå…¥å£é¡ºåºæµã€‚</li>
</ol>
</div></template>


