<template><div><h1 id="🧩typora-结合-lightbox-放大查看图片" tabindex="-1"><a class="header-anchor" href="#🧩typora-结合-lightbox-放大查看图片" aria-hidden="true">#</a> 🧩Typora 结合 LightBox 放大查看图片</h1>
<hr/>
<nav class="table-of-contents"><ul><li><router-link to="#引入-css-文件">引入 CSS 文件</router-link></li><li><router-link to="#引入-js-文件">引入 JS 文件</router-link></li><li><router-link to="#为-img-标签绑定双击事件-修改函数">为 img 标签绑定双击事件(修改函数)</router-link></li><li><router-link to="#注释-data-lightbox">注释 data-lightbox</router-link></li><li><router-link to="#调整图片位置居中">调整图片位置居中</router-link></li></ul></nav>
<p><a href="https://typoraio.cn/" target="_blank" rel="noopener noreferrer">Typora<ExternalLinkIcon/></a>默认是没有点击图片放大功能的，图片一旦插入，最大宽度只能是页面宽度，而无法放大查看，有时，原图片比较大，放到 Typora 中，完全无法看清内容，比如要看截图中的代码</p>
<blockquote>
<p>这时就需要我们自己配置。</p>
</blockquote>
<p>这里使用<code v-pre>LightBox</code>，来实现类似 WPS 放大预览图片的功能。</p>
<h1 id="从-github-下载-lightbox" tabindex="-1"><a class="header-anchor" href="#从-github-下载-lightbox" aria-hidden="true">#</a> 从 Github 下载 LightBox</h1>
<p><a href="https://github.com/lokesh/lightbox2" target="_blank" rel="noopener noreferrer">LightBox<ExternalLinkIcon/></a></p>
<p><img src="@source/notes/record/Typora结合LightBox放大查看图片/assets/image-20230516223833762.png" alt="image-20230516223833762"></p>
<h1 id="拷贝-dist-的文件" tabindex="-1"><a class="header-anchor" href="#拷贝-dist-的文件" aria-hidden="true">#</a> 拷贝 dist 的文件</h1>
<p>将 dist 文件夹下的内容拷贝到 Typora 安装目录的对应路径下</p>
<p><img src="@source/notes/record/Typora结合LightBox放大查看图片/assets/image-20230516224234229.png" alt="image-20230516224234229"></p>
<h1 id="修改-window-html-文件" tabindex="-1"><a class="header-anchor" href="#修改-window-html-文件" aria-hidden="true">#</a> 修改 window.html 文件</h1>
<p><code v-pre>window.html</code>这个文件实际就是 Typora 的主界面！！</p>
<p><img src="@source/notes/record/Typora结合LightBox放大查看图片/assets/image-20230516224310774.png" alt="image-20230516224310774"></p>
<p><img src="@source/notes/record/Typora结合LightBox放大查看图片/assets/image-20230516224347762.png" alt="image-20230516224347762"></p>
<h2 id="引入-css-文件" tabindex="-1"><a class="header-anchor" href="#引入-css-文件" aria-hidden="true">#</a> 引入 CSS 文件</h2>
<p>搜索<code v-pre>&lt;/head&gt;</code>，放在其前面即可</p>
<div class="language-html line-numbers-mode" data-ext="html"><pre v-pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./extend/lightbox2/css/lightbox.min.css<span class="token punctuation">"</span></span> <span class="token attr-name">crossorigin</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>anonymous<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="@source/notes/record/Typora结合LightBox放大查看图片/assets/image-20230516224449159.png" alt="image-20230516224449159"></p>
<h2 id="引入-js-文件" tabindex="-1"><a class="header-anchor" href="#引入-js-文件" aria-hidden="true">#</a> 引入 JS 文件</h2>
<p>搜索<code v-pre>&lt;script src=&quot;./appsrc/window/frame.js&quot; defer=&quot;defer&quot;&gt;&lt;/script&gt;</code>，放在其后面即可</p>
<div class="language-html line-numbers-mode" data-ext="html"><pre v-pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./extend/lightbox2/js/lightbox.js<span class="token punctuation">"</span></span> <span class="token attr-name">defer</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>defer<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="@source/notes/record/Typora结合LightBox放大查看图片/assets/image-20230516224543185.png" alt="image-20230516224543185"></p>
<h1 id="修改-lightbox-js-文件" tabindex="-1"><a class="header-anchor" href="#修改-lightbox-js-文件" aria-hidden="true">#</a> 修改 lightbox.js 文件</h1>
<p>因为 lightbox 需要有 <code v-pre>a</code> 标签包围着 <code v-pre>img</code> 标签，相应的点击事件是绑定在 <code v-pre>a</code> 标签上的，且需要 <code v-pre>href</code> 、 <code v-pre>data-lightbox</code> 、 <code v-pre>data-alt</code> 等属性，而 Typora 中的图片只有 <code v-pre>img</code> 标签，父级没有 <code v-pre>a</code> 标签，也没有相应要求的属性。因此需要改造一下 <code v-pre>lightbox.js</code> 文件。</p>
<p><img src="@source/notes/record/Typora结合LightBox放大查看图片/assets/image-20230516224756785.png" alt="image-20230516224756785"></p>
<h2 id="为-img-标签绑定双击事件-修改函数" tabindex="-1"><a class="header-anchor" href="#为-img-标签绑定双击事件-修改函数" aria-hidden="true">#</a> 为 img 标签绑定双击事件(修改函数)</h2>
<p>搜索<code v-pre>Lightbox.prototype.enable</code>，在其后添加代码</p>
<div class="language-javascript line-numbers-mode" data-ext="js"><pre v-pre class="language-javascript"><code><span class="token comment">//为img绑定双击事件，但要排除本就是双击放大展示的图片</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'dblclick'</span><span class="token punctuation">,</span> <span class="token string">"img:not([class='lb-image'])"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  self<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>currentTarget<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="@source/notes/record/Typora结合LightBox放大查看图片/assets/image-20230516224953170.png" alt="image-20230516224953170"></p>
<p>lightbox 用到三个属性：<code v-pre>alt</code>、<code v-pre>href</code>、<code v-pre>title</code>，这三个属性在 img 标签中均有对应的。
修改 start 函数，换成 img 对应属性：</p>
<p>搜索<code v-pre>Lightbox.prototype.start</code>,添加以下代码</p>
<div class="language-javascript line-numbers-mode" data-ext="js"><pre v-pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">addToAlbum</span><span class="token punctuation">(</span><span class="token parameter">$link</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  self<span class="token punctuation">.</span>album<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">alt</span><span class="token operator">:</span> $link<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'data-alt'</span><span class="token punctuation">)</span> <span class="token operator">||</span> $link<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'alt'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">link</span><span class="token operator">:</span> $link<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span> <span class="token operator">||</span> $link<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">title</span><span class="token operator">:</span> $link<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'data-title'</span><span class="token punctuation">)</span> <span class="token operator">||</span> $link<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="@source/notes/record/Typora结合LightBox放大查看图片/assets/image-20230516225042133.png" alt="image-20230516225042133"></p>
<h2 id="注释-data-lightbox" tabindex="-1"><a class="header-anchor" href="#注释-data-lightbox" aria-hidden="true">#</a> 注释 data-lightbox</h2>
<p>还有另外一个属性<code v-pre>data-lightbox</code>，img 没有该属性，因此这里不使用，lightbox 中有一段判断是否有该属性的代码，修改不存在该属性时的逻辑代码（注释掉原有的，添加<code v-pre>addToAlbum($link);</code>）：
搜索<code v-pre>addToAlbum($link);</code></p>
<p><img src="@source/notes/record/Typora结合LightBox放大查看图片/assets/image-20230516225115241.png" alt="image-20230516225115241"></p>
<h2 id="调整图片位置居中" tabindex="-1"><a class="header-anchor" href="#调整图片位置居中" aria-hidden="true">#</a> 调整图片位置居中</h2>
<p>此时图片是位于最上面的，修改<code v-pre>\extend\lightbox2\css\lightbox.min.css</code>中的<code v-pre>.lb-image</code>，给顶部和底部预留 20%空间即可</p>
<p><img src="@source/notes/record/Typora结合LightBox放大查看图片/assets/image-20230516225314504.png" alt="image-20230516225314504"></p>
<p>修改完毕，保存即可。</p>
<h1 id="添加滚轮滑动放大和双击关闭功能" tabindex="-1"><a class="header-anchor" href="#添加滚轮滑动放大和双击关闭功能" aria-hidden="true">#</a> 添加滚轮滑动放大和双击关闭功能</h1>
<p>将以下代码直接替换到<code v-pre>lightbox.js</code>即可</p>
<div class="language-javascript line-numbers-mode" data-ext="js"><pre v-pre class="language-javascript"><code><span class="token comment">// Uses Node, AMD or browser globals to create a module.</span>
<span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">root<span class="token punctuation">,</span> factory</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> define <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">&amp;&amp;</span> define<span class="token punctuation">.</span>amd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// AMD. Register as an anonymous module.</span>
    <span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'jquery'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> factory<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> exports <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Node. Does not work with strict CommonJS, but</span>
    <span class="token comment">// only CommonJS-like environments that support module.exports,</span>
    <span class="token comment">// like Node.</span>
    module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'jquery'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// Browser globals (root is window)</span>
    root<span class="token punctuation">.</span>lightbox <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>jQuery<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">$</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">Lightbox</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>album <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>currentImageIndex <span class="token operator">=</span> <span class="token keyword">void</span> <span class="token number">0</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// options</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>constructor<span class="token punctuation">.</span>defaults<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Descriptions of all options available on the demo site:</span>
  <span class="token comment">// http://lokeshdhakar.com/projects/lightbox2/index.html#options</span>
  Lightbox<span class="token punctuation">.</span>defaults <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">albumLabel</span><span class="token operator">:</span> <span class="token string">'Image %1 of %2'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">alwaysShowNavOnTouchDevices</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">fadeDuration</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token literal-property property">fitImagesInViewport</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">imageFadeDuration</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token comment">// maxWidth: 800,</span>
    <span class="token comment">// maxHeight: 600,</span>
    <span class="token literal-property property">positionFromTop</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token literal-property property">resizeDuration</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token literal-property property">showImageNumberLabel</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">wrapAround</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">disableScrolling</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token comment">/*
Sanitize Title
If the caption data is trusted, for example you are hardcoding it in, then leave this to false.
This will free you to add html tags, such as links, in the caption.

If the caption data is user submitted or from some other untrusted source, then set this to true
to prevent xss and other injection attacks.
 */</span>
    <span class="token literal-property property">sanitizeTitle</span><span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">Lightbox</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">option</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    $<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">Lightbox</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">imageCountLabel</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">currentImageNum<span class="token punctuation">,</span> totalImages</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>albumLabel<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">%1</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> currentImageNum<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">%2</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> totalImages<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">Lightbox</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">init</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> self <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token comment">// Both enable and build methods require the body tag to be in the DOM.</span>
    <span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ready</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      self<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      self<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Loop through anchors and areamaps looking for either data-lightbox attributes or rel attributes</span>
  <span class="token comment">// that contain 'lightbox'. When these are clicked, start lightbox.</span>
  <span class="token class-name">Lightbox</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">enable</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> self <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token string">'a[rel^=lightbox], area[rel^=lightbox], a[data-lightbox], area[data-lightbox]'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      self<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>currentTarget<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">//为img绑定双击事件，但要排除本就是双击放大展示的图片</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'dblclick'</span><span class="token punctuation">,</span> <span class="token string">"img:not([class='lb-image'])"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      self<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>currentTarget<span class="token punctuation">)</span><span class="token punctuation">)</span>
      self<span class="token punctuation">.</span>$image<span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">'zoom'</span><span class="token punctuation">,</span> <span class="token string">'100%'</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Build html for the lightbox and the overlay.</span>
  <span class="token comment">// Attach event handlers to the new DOM elements. click click click</span>
  <span class="token class-name">Lightbox</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">build</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#lightbox'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> self <span class="token operator">=</span> <span class="token keyword">this</span>

    <span class="token comment">// The two root notes generated, #lightboxOverlay and #lightbox are given</span>
    <span class="token comment">// tabindex attrs so they are focusable. We attach our keyboard event</span>
    <span class="token comment">// listeners to these two elements, and not the document. Clicking anywhere</span>
    <span class="token comment">// while Lightbox is opened will keep the focus on or inside one of these</span>
    <span class="token comment">// two elements.</span>
    <span class="token comment">//</span>
    <span class="token comment">// We do this so we can prevent propogation of the Esc keypress when</span>
    <span class="token comment">// Lightbox is open. This prevents it from intefering with other components</span>
    <span class="token comment">// on the page below.</span>
    <span class="token comment">//</span>
    <span class="token comment">// Github issue: https://github.com/lokesh/lightbox2/issues/663</span>
    <span class="token function">$</span><span class="token punctuation">(</span>
      <span class="token string">'&lt;div id="lightboxOverlay" tabindex="-1" class="lightboxOverlay">&lt;/div>&lt;div id="lightbox" tabindex="-1" class="lightbox">&lt;div class="lb-outerContainer">&lt;div class="lb-container">&lt;img class="lb-image" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" alt=""/>&lt;div class="lb-nav">&lt;a class="lb-prev" aria-label="Previous image" href="" >&lt;/a>&lt;a class="lb-next" aria-label="Next image" href="" >&lt;/a>&lt;/div>&lt;div class="lb-loader">&lt;a class="lb-cancel">&lt;/a>&lt;/div>&lt;/div>&lt;/div>&lt;div class="lb-dataContainer">&lt;div class="lb-data">&lt;div class="lb-details">&lt;span class="lb-caption">&lt;/span>&lt;span class="lb-number">&lt;/span>&lt;/div>&lt;div class="lb-closeContainer">&lt;a class="lb-close">&lt;/a>&lt;/div>&lt;/div>&lt;/div>&lt;/div>'</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendTo</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment">// Cache jQuery objects</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$lightbox <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#lightbox'</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$overlay <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#lightboxOverlay'</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$outerContainer <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$lightbox<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.lb-outerContainer'</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$container <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$lightbox<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.lb-container'</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$image <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$lightbox<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.lb-image'</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$nav <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$lightbox<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.lb-nav'</span><span class="token punctuation">)</span>

    <span class="token comment">// Store css values for future lookup</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>containerPadding <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$container<span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">'padding-top'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">right</span><span class="token operator">:</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$container<span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">'padding-right'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">bottom</span><span class="token operator">:</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$container<span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">'padding-bottom'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$container<span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">'padding-left'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>imageBorderWidth <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$image<span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">'border-top-width'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">right</span><span class="token operator">:</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$image<span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">'border-right-width'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">bottom</span><span class="token operator">:</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$image<span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">'border-bottom-width'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$image<span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">'border-left-width'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Attach event handlers to the newly minted DOM elements</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$overlay<span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      self<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>$lightbox<span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'lightbox'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        self<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>$outerContainer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'lightbox'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        self<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>$lightbox<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.lb-prev'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>currentImageIndex <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        self<span class="token punctuation">.</span><span class="token function">changeImage</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>album<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        self<span class="token punctuation">.</span><span class="token function">changeImage</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>currentImageIndex <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>$lightbox<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.lb-next'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>currentImageIndex <span class="token operator">===</span> self<span class="token punctuation">.</span>album<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        self<span class="token punctuation">.</span><span class="token function">changeImage</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        self<span class="token punctuation">.</span><span class="token function">changeImage</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>currentImageIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">/*
  Show context menu for image on right-click

  There is a div containing the navigation that spans the entire image and lives above of it. If
  you right-click, you are right clicking this div and not the image. This prevents users from
  saving the image or using other context menu actions with the image.

  To fix this, when we detect the right mouse button is pressed down, but not yet clicked, we
  set pointer-events to none on the nav div. This is so that the upcoming right-click event on
  the next mouseup will bubble down to the image. Once the right-click/contextmenu event occurs
  we set the pointer events back to auto for the nav div so it can capture hover and left-click
  events as usual.
 */</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$nav<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'mousedown'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>which <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        self<span class="token punctuation">.</span>$nav<span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">'pointer-events'</span><span class="token punctuation">,</span> <span class="token string">'none'</span><span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>$lightbox<span class="token punctuation">.</span><span class="token function">one</span><span class="token punctuation">(</span><span class="token string">'contextmenu'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">setTimeout</span><span class="token punctuation">(</span>
            <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span>$nav<span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">'pointer-events'</span><span class="token punctuation">,</span> <span class="token string">'auto'</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token number">0</span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$container<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'mousewheel'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      event<span class="token punctuation">.</span>delta <span class="token operator">=</span> event<span class="token punctuation">.</span>originalEvent<span class="token punctuation">.</span>wheelDelta <span class="token operator">?</span> event<span class="token punctuation">.</span>originalEvent<span class="token punctuation">.</span>wheelDelta <span class="token operator">/</span> <span class="token number">120</span> <span class="token operator">:</span> <span class="token operator">-</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>originalEvent<span class="token punctuation">.</span>detail <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">3</span>

      <span class="token keyword">var</span> zoom <span class="token operator">=</span> self<span class="token punctuation">.</span>$image<span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">'zoom'</span><span class="token punctuation">)</span>
      zoom <span class="token operator">=</span> zoom <span class="token operator">?</span> zoom <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">:</span> <span class="token number">100</span>
      zoom <span class="token operator">+=</span> event<span class="token punctuation">.</span>delta <span class="token operator">*</span> <span class="token number">10</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>zoom <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> self<span class="token punctuation">.</span>$image<span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">'zoom'</span><span class="token punctuation">,</span> zoom <span class="token operator">+</span> <span class="token string">'%'</span><span class="token punctuation">)</span>

      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>$image<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>$image<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

      imageWidth <span class="token operator">=</span> self<span class="token punctuation">.</span>$image<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      imageHeight <span class="token operator">=</span> self<span class="token punctuation">.</span>$image<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      imageWidth <span class="token operator">=</span> imageWidth <span class="token operator">*</span> zoom <span class="token operator">*</span> <span class="token number">0.01</span>
      imageHeight <span class="token operator">=</span> imageHeight <span class="token operator">*</span> zoom <span class="token operator">*</span> <span class="token number">0.01</span>
      self<span class="token punctuation">.</span><span class="token function">sizeContainer</span><span class="token punctuation">(</span>imageWidth<span class="token punctuation">,</span> imageHeight<span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">//给放大的图片另外绑定双击关闭事件</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$container<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'dblclick'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      self<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>$lightbox<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.lb-loader, .lb-close'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      self<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Show overlay and lightbox. If the image is part of a set, add siblings to album array.</span>
  <span class="token class-name">Lightbox</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">start</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">$link</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> self <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">var</span> $window <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span>

    $window<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> $<span class="token punctuation">.</span><span class="token function">proxy</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sizeOverlay<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sizeOverlay</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>album <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">var</span> imageNumber <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">function</span> <span class="token function">addToAlbum</span><span class="token punctuation">(</span><span class="token parameter">$link</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      self<span class="token punctuation">.</span>album<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">alt</span><span class="token operator">:</span> $link<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'data-alt'</span><span class="token punctuation">)</span> <span class="token operator">||</span> $link<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'alt'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">link</span><span class="token operator">:</span> $link<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span> <span class="token operator">||</span> $link<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">title</span><span class="token operator">:</span> $link<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'data-title'</span><span class="token punctuation">)</span> <span class="token operator">||</span> $link<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Support both data-lightbox attribute and rel attribute implementations</span>
    <span class="token keyword">var</span> dataLightboxValue <span class="token operator">=</span> $link<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'data-lightbox'</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> $links

    <span class="token keyword">if</span> <span class="token punctuation">(</span>dataLightboxValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      $links <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>$link<span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">'tagName'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'[data-lightbox="'</span> <span class="token operator">+</span> dataLightboxValue <span class="token operator">+</span> <span class="token string">'"]'</span><span class="token punctuation">)</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> $links<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">=</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">addToAlbum</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span>$links<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>$links<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">===</span> $link<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          imageNumber <span class="token operator">=</span> i
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// if ($link.attr('rel') === 'lightbox') {</span>
      <span class="token comment">// If image is not part of a set</span>
      <span class="token comment">// addToAlbum($link);</span>
      <span class="token comment">// } else {</span>
      <span class="token comment">// // If image is part of a set</span>
      <span class="token comment">// $links = $($link.prop('tagName') + '[rel="' + $link.attr('rel') + '"]');</span>
      <span class="token comment">// for (var j = 0; j &lt; $links.length; j = ++j) {</span>
      <span class="token comment">//   addToAlbum($($links[j]));</span>
      <span class="token comment">//   if ($links[j] === $link[0]) {</span>
      <span class="token comment">//     imageNumber = j;</span>
      <span class="token comment">//   }</span>
      <span class="token comment">// }</span>
      <span class="token function">addToAlbum</span><span class="token punctuation">(</span>$link<span class="token punctuation">)</span>
      <span class="token comment">// }</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Position Lightbox</span>
    <span class="token keyword">var</span> top <span class="token operator">=</span> $window<span class="token punctuation">.</span><span class="token function">scrollTop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>positionFromTop
    <span class="token keyword">var</span> left <span class="token operator">=</span> $window<span class="token punctuation">.</span><span class="token function">scrollLeft</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$lightbox
      <span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">top</span><span class="token operator">:</span> top <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">left</span><span class="token operator">:</span> left <span class="token operator">+</span> <span class="token string">'px'</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">fadeIn</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>fadeDuration<span class="token punctuation">)</span>

    <span class="token comment">// Disable scrolling of the page while open</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>disableScrolling<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addClass</span><span class="token punctuation">(</span><span class="token string">'lb-disable-scrolling'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeImage</span><span class="token punctuation">(</span>imageNumber<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Hide most UI elements in preparation for the animated resizing of the lightbox.</span>
  <span class="token class-name">Lightbox</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">changeImage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">imageNumber</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> self <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">var</span> filename <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>album<span class="token punctuation">[</span>imageNumber<span class="token punctuation">]</span><span class="token punctuation">.</span>link
    <span class="token keyword">var</span> filetype <span class="token operator">=</span> filename<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">var</span> $image <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$lightbox<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.lb-image'</span><span class="token punctuation">)</span>

    <span class="token comment">// Disable keyboard nav during transitions</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">disableKeyboardNav</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// Show loading state</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$overlay<span class="token punctuation">.</span><span class="token function">fadeIn</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>fadeDuration<span class="token punctuation">)</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.lb-loader'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fadeIn</span><span class="token punctuation">(</span><span class="token string">'slow'</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$lightbox<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.lb-image, .lb-nav, .lb-prev, .lb-next, .lb-dataContainer, .lb-numbers, .lb-caption'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$outerContainer<span class="token punctuation">.</span><span class="token function">addClass</span><span class="token punctuation">(</span><span class="token string">'animating'</span><span class="token punctuation">)</span>

    <span class="token comment">// When image to show is preloaded, we send the width and height to sizeContainer()</span>
    <span class="token keyword">var</span> preloader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    preloader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> $preloader
      <span class="token keyword">var</span> imageHeight
      <span class="token keyword">var</span> imageWidth
      <span class="token keyword">var</span> maxImageHeight
      <span class="token keyword">var</span> maxImageWidth
      <span class="token keyword">var</span> windowHeight
      <span class="token keyword">var</span> windowWidth

      $image<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">alt</span><span class="token operator">:</span> self<span class="token punctuation">.</span>album<span class="token punctuation">[</span>imageNumber<span class="token punctuation">]</span><span class="token punctuation">.</span>alt<span class="token punctuation">,</span>
        <span class="token literal-property property">src</span><span class="token operator">:</span> filename
      <span class="token punctuation">}</span><span class="token punctuation">)</span>

      $preloader <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>preloader<span class="token punctuation">)</span>

      $image<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span>preloader<span class="token punctuation">.</span>width<span class="token punctuation">)</span>
      $image<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span>preloader<span class="token punctuation">.</span>height<span class="token punctuation">)</span>
      windowWidth <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      windowHeight <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

      <span class="token comment">// Calculate the max image dimensions for the current viewport.</span>
      <span class="token comment">// Take into account the border around the image and an additional 10px gutter on each side.</span>
      maxImageWidth <span class="token operator">=</span> windowWidth <span class="token operator">-</span> self<span class="token punctuation">.</span>containerPadding<span class="token punctuation">.</span>left <span class="token operator">-</span> self<span class="token punctuation">.</span>containerPadding<span class="token punctuation">.</span>right <span class="token operator">-</span> self<span class="token punctuation">.</span>imageBorderWidth<span class="token punctuation">.</span>left <span class="token operator">-</span> self<span class="token punctuation">.</span>imageBorderWidth<span class="token punctuation">.</span>right <span class="token operator">-</span> <span class="token number">20</span>
      maxImageHeight <span class="token operator">=</span> windowHeight <span class="token operator">-</span> self<span class="token punctuation">.</span>containerPadding<span class="token punctuation">.</span>top <span class="token operator">-</span> self<span class="token punctuation">.</span>containerPadding<span class="token punctuation">.</span>bottom <span class="token operator">-</span> self<span class="token punctuation">.</span>imageBorderWidth<span class="token punctuation">.</span>top <span class="token operator">-</span> self<span class="token punctuation">.</span>imageBorderWidth<span class="token punctuation">.</span>bottom <span class="token operator">-</span> self<span class="token punctuation">.</span>options<span class="token punctuation">.</span>positionFromTop <span class="token operator">-</span> <span class="token number">70</span>

      <span class="token comment">/*
  Since many SVGs have small intrinsic dimensions, but they support scaling
  up without quality loss because of their vector format, max out their
  size.
  */</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>filetype <span class="token operator">===</span> <span class="token string">'svg'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        $image<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span>maxImageWidth<span class="token punctuation">)</span>
        $image<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span>maxImageHeight<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// Fit image inside the viewport.</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>options<span class="token punctuation">.</span>fitImagesInViewport<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Check if image size is larger then maxWidth|maxHeight in settings</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>options<span class="token punctuation">.</span>maxWidth <span class="token operator">&amp;&amp;</span> self<span class="token punctuation">.</span>options<span class="token punctuation">.</span>maxWidth <span class="token operator">&lt;</span> maxImageWidth<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          maxImageWidth <span class="token operator">=</span> self<span class="token punctuation">.</span>options<span class="token punctuation">.</span>maxWidth
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>options<span class="token punctuation">.</span>maxHeight <span class="token operator">&amp;&amp;</span> self<span class="token punctuation">.</span>options<span class="token punctuation">.</span>maxHeight <span class="token operator">&lt;</span> maxImageHeight<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          maxImageHeight <span class="token operator">=</span> self<span class="token punctuation">.</span>options<span class="token punctuation">.</span>maxHeight
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        maxImageWidth <span class="token operator">=</span> self<span class="token punctuation">.</span>options<span class="token punctuation">.</span>maxWidth <span class="token operator">||</span> preloader<span class="token punctuation">.</span>width <span class="token operator">||</span> maxImageWidth
        maxImageHeight <span class="token operator">=</span> self<span class="token punctuation">.</span>options<span class="token punctuation">.</span>maxHeight <span class="token operator">||</span> preloader<span class="token punctuation">.</span>height <span class="token operator">||</span> maxImageHeight
      <span class="token punctuation">}</span>

      <span class="token comment">// Is the current image's width or height is greater than the maxImageWidth or maxImageHeight</span>
      <span class="token comment">// option than we need to size down while maintaining the aspect ratio.</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>preloader<span class="token punctuation">.</span>width <span class="token operator">></span> maxImageWidth <span class="token operator">||</span> preloader<span class="token punctuation">.</span>height <span class="token operator">></span> maxImageHeight<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>preloader<span class="token punctuation">.</span>width <span class="token operator">/</span> maxImageWidth <span class="token operator">></span> preloader<span class="token punctuation">.</span>height <span class="token operator">/</span> maxImageHeight<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          imageWidth <span class="token operator">=</span> maxImageWidth
          imageHeight <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>preloader<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token punctuation">(</span>preloader<span class="token punctuation">.</span>width <span class="token operator">/</span> imageWidth<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
          $image<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span>imageWidth<span class="token punctuation">)</span>
          $image<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span>imageHeight<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          imageHeight <span class="token operator">=</span> maxImageHeight
          imageWidth <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>preloader<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token punctuation">(</span>preloader<span class="token punctuation">.</span>height <span class="token operator">/</span> imageHeight<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
          $image<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span>imageWidth<span class="token punctuation">)</span>
          $image<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span>imageHeight<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      self<span class="token punctuation">.</span><span class="token function">sizeContainer</span><span class="token punctuation">(</span>$image<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> $image<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Preload image before showing</span>
    preloader<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>album<span class="token punctuation">[</span>imageNumber<span class="token punctuation">]</span><span class="token punctuation">.</span>link
    <span class="token keyword">this</span><span class="token punctuation">.</span>currentImageIndex <span class="token operator">=</span> imageNumber
  <span class="token punctuation">}</span>

  <span class="token comment">// Stretch overlay to fit the viewport</span>
  <span class="token class-name">Lightbox</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sizeOverlay</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> self <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token comment">/*
We use a setTimeout 0 to pause JS execution and let the rendering catch-up.
Why do this? If the `disableScrolling` option is set to true, a class is added to the body
tag that disables scrolling and hides the scrollbar. We want to make sure the scrollbar is
hidden before we measure the document width, as the presence of the scrollbar will affect the
number.
*/</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      self<span class="token punctuation">.</span>$overlay<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Animate the size of the lightbox to fit the image we are showing</span>
  <span class="token comment">// This method also shows the the image.</span>
  <span class="token class-name">Lightbox</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sizeContainer</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">imageWidth<span class="token punctuation">,</span> imageHeight</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> self <span class="token operator">=</span> <span class="token keyword">this</span>

    <span class="token keyword">var</span> oldWidth <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$outerContainer<span class="token punctuation">.</span><span class="token function">outerWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> oldHeight <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$outerContainer<span class="token punctuation">.</span><span class="token function">outerHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> newWidth <span class="token operator">=</span> imageWidth <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>containerPadding<span class="token punctuation">.</span>left <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>containerPadding<span class="token punctuation">.</span>right <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>imageBorderWidth<span class="token punctuation">.</span>left <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>imageBorderWidth<span class="token punctuation">.</span>right
    <span class="token keyword">var</span> newHeight <span class="token operator">=</span> imageHeight <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>containerPadding<span class="token punctuation">.</span>top <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>containerPadding<span class="token punctuation">.</span>bottom <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>imageBorderWidth<span class="token punctuation">.</span>top <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>imageBorderWidth<span class="token punctuation">.</span>bottom

    <span class="token comment">//最大不超过屏幕宽高，若超过，滚动条出现</span>
    windowWidth <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    windowHeight <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>newWidth <span class="token operator">></span> windowWidth<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      newWidth <span class="token operator">=</span> windowWidth
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>newHeight <span class="token operator">+</span> self<span class="token punctuation">.</span>$lightbox<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.lb-dataContainer'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> windowHeight<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      newHeight <span class="token operator">=</span> windowHeight <span class="token operator">-</span> self<span class="token punctuation">.</span>$lightbox<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.lb-dataContainer'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">postResize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      self<span class="token punctuation">.</span>$lightbox<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.lb-dataContainer'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span>newWidth<span class="token punctuation">)</span>
      self<span class="token punctuation">.</span>$lightbox<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.lb-prevLink'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span>newHeight<span class="token punctuation">)</span>
      self<span class="token punctuation">.</span>$lightbox<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.lb-nextLink'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span>newHeight<span class="token punctuation">)</span>

      <span class="token comment">// Set focus on one of the two root nodes so keyboard events are captured.</span>
      self<span class="token punctuation">.</span>$overlay<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

      self<span class="token punctuation">.</span><span class="token function">showImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldWidth <span class="token operator">!==</span> newWidth <span class="token operator">||</span> oldHeight <span class="token operator">!==</span> newHeight<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$outerContainer<span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">width</span><span class="token operator">:</span> newWidth<span class="token punctuation">,</span>
          <span class="token literal-property property">height</span><span class="token operator">:</span> newHeight
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>resizeDuration<span class="token punctuation">,</span>
        <span class="token string">'swing'</span><span class="token punctuation">,</span>
        <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">postResize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">postResize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Display the image and its details and begin preload neighboring images.</span>
  <span class="token class-name">Lightbox</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">showImage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$lightbox<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.lb-loader'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$lightbox<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.lb-image'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fadeIn</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>imageFadeDuration<span class="token punctuation">)</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateNav</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateDetails</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">preloadNeighboringImages</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">enableKeyboardNav</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Display previous and next navigation if appropriate.</span>
  <span class="token class-name">Lightbox</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">updateNav</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Check to see if the browser supports touch events. If so, we take the conservative approach</span>
    <span class="token comment">// and assume that mouse hover events are not supported and always show prev/next navigation</span>
    <span class="token comment">// arrows in image sets.</span>
    <span class="token keyword">var</span> alwaysShowNav <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      document<span class="token punctuation">.</span><span class="token function">createEvent</span><span class="token punctuation">(</span><span class="token string">'TouchEvent'</span><span class="token punctuation">)</span>
      alwaysShowNav <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>alwaysShowNavOnTouchDevices <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>$lightbox<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.lb-nav'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>album<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>wrapAround<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>alwaysShowNav<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>$lightbox<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.lb-prev, .lb-next'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$lightbox<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.lb-prev, .lb-next'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentImageIndex <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>$lightbox<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.lb-prev'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>alwaysShowNav<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>$lightbox<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.lb-prev'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentImageIndex <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>album<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>$lightbox<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.lb-next'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>alwaysShowNav<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>$lightbox<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.lb-next'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Display caption, image number, and closing button.</span>
  <span class="token class-name">Lightbox</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">updateDetails</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> self <span class="token operator">=</span> <span class="token keyword">this</span>

    <span class="token comment">// Enable anchor clicks in the injected caption html.</span>
    <span class="token comment">// Thanks Nate Wright for the fix. @https://github.com/NateWr</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token keyword">this</span><span class="token punctuation">.</span>album<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentImageIndex<span class="token punctuation">]</span><span class="token punctuation">.</span>title <span class="token operator">!==</span> <span class="token string">'undefined'</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>album<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentImageIndex<span class="token punctuation">]</span><span class="token punctuation">.</span>title <span class="token operator">!==</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> $caption <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$lightbox<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.lb-caption'</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>sanitizeTitle<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        $caption<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>album<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentImageIndex<span class="token punctuation">]</span><span class="token punctuation">.</span>title<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        $caption<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>album<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentImageIndex<span class="token punctuation">]</span><span class="token punctuation">.</span>title<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      $caption<span class="token punctuation">.</span><span class="token function">fadeIn</span><span class="token punctuation">(</span><span class="token string">'fast'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>album<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>showImageNumberLabel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> labelText <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">imageCountLabel</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentImageIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>album<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$lightbox<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.lb-number'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>labelText<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fadeIn</span><span class="token punctuation">(</span><span class="token string">'fast'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$lightbox<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.lb-number'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>$outerContainer<span class="token punctuation">.</span><span class="token function">removeClass</span><span class="token punctuation">(</span><span class="token string">'animating'</span><span class="token punctuation">)</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>$lightbox<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.lb-dataContainer'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fadeIn</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>resizeDuration<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> self<span class="token punctuation">.</span><span class="token function">sizeOverlay</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Preload previous and next images in set.</span>
  <span class="token class-name">Lightbox</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">preloadNeighboringImages</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>album<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token keyword">this</span><span class="token punctuation">.</span>currentImageIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> preloadNext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      preloadNext<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>album<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentImageIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>link
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentImageIndex <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> preloadPrev <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      preloadPrev<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>album<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentImageIndex <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>link
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">Lightbox</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">enableKeyboardNav</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$lightbox<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'keyup.keyboard'</span><span class="token punctuation">,</span> $<span class="token punctuation">.</span><span class="token function">proxy</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>keyboardAction<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$overlay<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'keyup.keyboard'</span><span class="token punctuation">,</span> $<span class="token punctuation">.</span><span class="token function">proxy</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>keyboardAction<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">Lightbox</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">disableKeyboardNav</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$lightbox<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">'.keyboard'</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$overlay<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">'.keyboard'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">Lightbox</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">keyboardAction</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> <span class="token constant">KEYCODE_ESC</span> <span class="token operator">=</span> <span class="token number">27</span>
    <span class="token keyword">var</span> <span class="token constant">KEYCODE_LEFTARROW</span> <span class="token operator">=</span> <span class="token number">37</span>
    <span class="token keyword">var</span> <span class="token constant">KEYCODE_RIGHTARROW</span> <span class="token operator">=</span> <span class="token number">39</span>

    <span class="token keyword">var</span> keycode <span class="token operator">=</span> event<span class="token punctuation">.</span>keyCode
    <span class="token keyword">if</span> <span class="token punctuation">(</span>keycode <span class="token operator">===</span> <span class="token constant">KEYCODE_ESC</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Prevent bubbling so as to not affect other components on the page.</span>
      event<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>keycode <span class="token operator">===</span> <span class="token constant">KEYCODE_LEFTARROW</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentImageIndex <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeImage</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentImageIndex <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>wrapAround <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>album<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeImage</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>album<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>keycode <span class="token operator">===</span> <span class="token constant">KEYCODE_RIGHTARROW</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentImageIndex <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>album<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeImage</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentImageIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>wrapAround <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>album<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeImage</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Closing time. :-(</span>
  <span class="token class-name">Lightbox</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">end</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">disableKeyboardNav</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">$</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sizeOverlay<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$lightbox<span class="token punctuation">.</span><span class="token function">fadeOut</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>fadeDuration<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$overlay<span class="token punctuation">.</span><span class="token function">fadeOut</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>fadeDuration<span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>disableScrolling<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeClass</span><span class="token punctuation">(</span><span class="token string">'lb-disable-scrolling'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Lightbox</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="@source/notes/record/Typora结合LightBox放大查看图片/assets/image-20230516225619076.png" alt="image-20230516225619076"></p>
<h1 id="验证" tabindex="-1"><a class="header-anchor" href="#验证" aria-hidden="true">#</a> 验证</h1>
<p>重启 Typora，双击图片，可放大即配置成功。</p>
</div></template>


